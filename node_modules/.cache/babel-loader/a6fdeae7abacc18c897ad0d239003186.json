{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ClassificationModel = exports.ObjectDetectionModel = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar tf = _interopRequireWildcard(require(\"@tensorflow/tfjs\"));\n\nvar Model = /*#__PURE__*/function () {\n  function Model() {\n    (0, _classCallCheck2[\"default\"])(this, Model);\n  }\n\n  (0, _createClass2[\"default\"])(Model, [{\n    key: \"loadModelAsync\",\n    value: function () {\n      var _loadModelAsync = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee(modelUrl) {\n        var options,\n            _args = arguments;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                options = _args.length > 1 && _args[1] !== undefined ? _args[1] : null;\n                _context.next = 3;\n                return tf.loadGraphModel(modelUrl, options);\n\n              case 3:\n                this.model = _context.sent;\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function loadModelAsync(_x) {\n        return _loadModelAsync.apply(this, arguments);\n      }\n\n      return loadModelAsync;\n    }()\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      this.model.dispose();\n    }\n  }, {\n    key: \"executeAsync\",\n    value: function () {\n      var _executeAsync = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2(pixels) {\n        var inputs, outputs;\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                inputs = pixels instanceof tf.Tensor ? pixels : this._preprocess(tf.browser.fromPixels(pixels, 3));\n                outputs = this.model.execute(inputs);\n                _context2.t0 = this;\n                _context2.next = 5;\n                return outputs.array();\n\n              case 5:\n                _context2.t1 = _context2.sent;\n                _context2.next = 8;\n                return _context2.t0._postprocess.call(_context2.t0, _context2.t1);\n\n              case 8:\n                return _context2.abrupt(\"return\", _context2.sent);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function executeAsync(_x2) {\n        return _executeAsync.apply(this, arguments);\n      }\n\n      return executeAsync;\n    }()\n  }]);\n  return Model;\n}();\n\nvar ObjectDetectionModel = /*#__PURE__*/function (_Model) {\n  (0, _inherits2[\"default\"])(ObjectDetectionModel, _Model);\n\n  function ObjectDetectionModel() {\n    var _this;\n\n    (0, _classCallCheck2[\"default\"])(this, ObjectDetectionModel);\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(ObjectDetectionModel).call(this));\n    _this.ANCHORS = [0.573, 0.677, 1.87, 2.06, 3.34, 5.47, 7.88, 3.53, 9.77, 9.17];\n    _this.INPUT_SIZE = 416;\n    return _this;\n  }\n\n  (0, _createClass2[\"default\"])(ObjectDetectionModel, [{\n    key: \"_preprocess\",\n    value: function _preprocess(image) {\n      var rgb_image = tf.image.resizeBilinear(image.expandDims().toFloat(), [this.INPUT_SIZE, this.INPUT_SIZE]);\n      return rgb_image.reverse(-1); // RGB -> BGR\n    }\n  }, {\n    key: \"_postprocess\",\n    value: function () {\n      var _postprocess2 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3(outputs) {\n        var num_anchor, channels, height, width, num_class, boxes, scores, classes, grid_y, grid_x, offset, i, x, y, w, h, objectness, class_probabilities, max_index, selected_indices;\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                // TODO: Need more efficient implmentation\n                num_anchor = this.ANCHORS.length / 2;\n                channels = outputs[0][0][0].length;\n                height = outputs[0].length;\n                width = outputs[0][0].length;\n                num_class = channels / num_anchor - 5;\n                boxes = [];\n                scores = [];\n                classes = [];\n\n                for (grid_y = 0; grid_y < height; grid_y++) {\n                  for (grid_x = 0; grid_x < width; grid_x++) {\n                    offset = 0;\n\n                    for (i = 0; i < num_anchor; i++) {\n                      x = (this._logistic(outputs[0][grid_y][grid_x][offset++]) + grid_x) / width;\n                      y = (this._logistic(outputs[0][grid_y][grid_x][offset++]) + grid_y) / height;\n                      w = Math.exp(outputs[0][grid_y][grid_x][offset++]) * this.ANCHORS[i * 2] / width;\n                      h = Math.exp(outputs[0][grid_y][grid_x][offset++]) * this.ANCHORS[i * 2 + 1] / height;\n                      objectness = tf.scalar(this._logistic(outputs[0][grid_y][grid_x][offset++]));\n                      class_probabilities = tf.tensor1d(outputs[0][grid_y][grid_x].slice(offset, offset + num_class)).softmax();\n                      offset += num_class;\n                      class_probabilities = class_probabilities.mul(objectness);\n                      max_index = class_probabilities.argMax();\n                      boxes.push([x - w / 2, y - h / 2, x + w / 2, y + h / 2]);\n                      scores.push(class_probabilities.max().dataSync()[0]);\n                      classes.push(max_index.dataSync()[0]);\n                    }\n                  }\n                }\n\n                boxes = tf.tensor2d(boxes);\n                scores = tf.tensor1d(scores);\n                classes = tf.tensor1d(classes);\n                _context3.next = 14;\n                return tf.image.nonMaxSuppressionAsync(boxes, scores, 10);\n\n              case 14:\n                selected_indices = _context3.sent;\n                _context3.next = 17;\n                return boxes.gather(selected_indices).array();\n\n              case 17:\n                _context3.t0 = _context3.sent;\n                _context3.next = 20;\n                return scores.gather(selected_indices).array();\n\n              case 20:\n                _context3.t1 = _context3.sent;\n                _context3.next = 23;\n                return classes.gather(selected_indices).array();\n\n              case 23:\n                _context3.t2 = _context3.sent;\n                return _context3.abrupt(\"return\", [_context3.t0, _context3.t1, _context3.t2]);\n\n              case 25:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function _postprocess(_x3) {\n        return _postprocess2.apply(this, arguments);\n      }\n\n      return _postprocess;\n    }()\n  }, {\n    key: \"_logistic\",\n    value: function _logistic(x) {\n      if (x > 0) {\n        return 1 / (1 + Math.exp(-x));\n      } else {\n        var e = Math.exp(x);\n        return e / (1 + e);\n      }\n    }\n  }]);\n  return ObjectDetectionModel;\n}(Model);\n\nexports.ObjectDetectionModel = ObjectDetectionModel;\n\nvar ClassificationModel = /*#__PURE__*/function (_Model2) {\n  (0, _inherits2[\"default\"])(ClassificationModel, _Model2);\n\n  function ClassificationModel() {\n    var _this2;\n\n    (0, _classCallCheck2[\"default\"])(this, ClassificationModel);\n    _this2 = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(ClassificationModel).call(this));\n    _this2.INPUT_SIZE = 224;\n    return _this2;\n  }\n\n  (0, _createClass2[\"default\"])(ClassificationModel, [{\n    key: \"_postprocess\",\n    value: function () {\n      var _postprocess3 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(outputs) {\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", outputs);\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function _postprocess(_x4) {\n        return _postprocess3.apply(this, arguments);\n      }\n\n      return _postprocess;\n    }()\n  }, {\n    key: \"_preprocess\",\n    value: function _preprocess(image) {\n      // CenterCrop\n      var _image$shape$slice = image.shape.slice(0, 2),\n          _image$shape$slice2 = (0, _slicedToArray2[\"default\"])(_image$shape$slice, 2),\n          h = _image$shape$slice2[0],\n          w = _image$shape$slice2[1];\n\n      var top = h > w ? (h - w) / 2 : 0;\n      var left = h > w ? 0 : (w - h) / 2;\n      var size = Math.min(h, w);\n      var rgb_image = tf.image.cropAndResize(image.expandDims().toFloat(), [[top / h, left / w, (top + size) / h, (left + size) / w]], [0], [this.INPUT_SIZE, this.INPUT_SIZE]);\n      return rgb_image.reverse(-1); // RGB -> BGR;\n    }\n  }]);\n  return ClassificationModel;\n}(Model);\n\nexports.ClassificationModel = ClassificationModel;","map":{"version":3,"sources":["/home/victor/COVID-19-Coding-Fest/node_modules/@microsoft/customvision-tfjs/lib/index.js"],"names":["_interopRequireWildcard","require","_interopRequireDefault","Object","defineProperty","exports","value","ClassificationModel","ObjectDetectionModel","_slicedToArray2","_possibleConstructorReturn2","_getPrototypeOf2","_inherits2","_regenerator","_asyncToGenerator2","_classCallCheck2","_createClass2","tf","Model","key","_loadModelAsync","mark","_callee","modelUrl","options","_args","arguments","wrap","_callee$","_context","prev","next","length","undefined","loadGraphModel","model","sent","stop","loadModelAsync","_x","apply","dispose","_executeAsync","_callee2","pixels","inputs","outputs","_callee2$","_context2","Tensor","_preprocess","browser","fromPixels","execute","t0","array","t1","_postprocess","call","abrupt","executeAsync","_x2","_Model","_this","ANCHORS","INPUT_SIZE","image","rgb_image","resizeBilinear","expandDims","toFloat","reverse","_postprocess2","_callee3","num_anchor","channels","height","width","num_class","boxes","scores","classes","grid_y","grid_x","offset","i","x","y","w","h","objectness","class_probabilities","max_index","selected_indices","_callee3$","_context3","_logistic","Math","exp","scalar","tensor1d","slice","softmax","mul","argMax","push","max","dataSync","tensor2d","nonMaxSuppressionAsync","gather","t2","_x3","e","_Model2","_this2","_postprocess3","_callee4","_callee4$","_context4","_x4","_image$shape$slice","shape","_image$shape$slice2","top","left","size","min","cropAndResize"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\r\n\r\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports.ClassificationModel = exports.ObjectDetectionModel = void 0;\r\n\r\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\r\n\r\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\r\n\r\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\r\n\r\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\r\n\r\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\r\n\r\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\r\n\r\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\r\n\r\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\r\n\r\nvar tf = _interopRequireWildcard(require(\"@tensorflow/tfjs\"));\r\n\r\nvar Model =\r\n/*#__PURE__*/\r\nfunction () {\r\n  function Model() {\r\n    (0, _classCallCheck2[\"default\"])(this, Model);\r\n  }\r\n\r\n  (0, _createClass2[\"default\"])(Model, [{\r\n    key: \"loadModelAsync\",\r\n    value: function () {\r\n      var _loadModelAsync = (0, _asyncToGenerator2[\"default\"])(\r\n      /*#__PURE__*/\r\n      _regenerator[\"default\"].mark(function _callee(modelUrl) {\r\n        var options,\r\n            _args = arguments;\r\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\r\n          while (1) {\r\n            switch (_context.prev = _context.next) {\r\n              case 0:\r\n                options = _args.length > 1 && _args[1] !== undefined ? _args[1] : null;\r\n                _context.next = 3;\r\n                return tf.loadGraphModel(modelUrl, options);\r\n\r\n              case 3:\r\n                this.model = _context.sent;\r\n\r\n              case 4:\r\n              case \"end\":\r\n                return _context.stop();\r\n            }\r\n          }\r\n        }, _callee, this);\r\n      }));\r\n\r\n      function loadModelAsync(_x) {\r\n        return _loadModelAsync.apply(this, arguments);\r\n      }\r\n\r\n      return loadModelAsync;\r\n    }()\r\n  }, {\r\n    key: \"dispose\",\r\n    value: function dispose() {\r\n      this.model.dispose();\r\n    }\r\n  }, {\r\n    key: \"executeAsync\",\r\n    value: function () {\r\n      var _executeAsync = (0, _asyncToGenerator2[\"default\"])(\r\n      /*#__PURE__*/\r\n      _regenerator[\"default\"].mark(function _callee2(pixels) {\r\n        var inputs, outputs;\r\n        return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\r\n          while (1) {\r\n            switch (_context2.prev = _context2.next) {\r\n              case 0:\r\n                inputs = pixels instanceof tf.Tensor ? pixels : this._preprocess(tf.browser.fromPixels(pixels, 3));\r\n                outputs = this.model.execute(inputs);\r\n                _context2.t0 = this;\r\n                _context2.next = 5;\r\n                return outputs.array();\r\n\r\n              case 5:\r\n                _context2.t1 = _context2.sent;\r\n                _context2.next = 8;\r\n                return _context2.t0._postprocess.call(_context2.t0, _context2.t1);\r\n\r\n              case 8:\r\n                return _context2.abrupt(\"return\", _context2.sent);\r\n\r\n              case 9:\r\n              case \"end\":\r\n                return _context2.stop();\r\n            }\r\n          }\r\n        }, _callee2, this);\r\n      }));\r\n\r\n      function executeAsync(_x2) {\r\n        return _executeAsync.apply(this, arguments);\r\n      }\r\n\r\n      return executeAsync;\r\n    }()\r\n  }]);\r\n  return Model;\r\n}();\r\n\r\nvar ObjectDetectionModel =\r\n/*#__PURE__*/\r\nfunction (_Model) {\r\n  (0, _inherits2[\"default\"])(ObjectDetectionModel, _Model);\r\n\r\n  function ObjectDetectionModel() {\r\n    var _this;\r\n\r\n    (0, _classCallCheck2[\"default\"])(this, ObjectDetectionModel);\r\n    _this = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(ObjectDetectionModel).call(this));\r\n    _this.ANCHORS = [0.573, 0.677, 1.87, 2.06, 3.34, 5.47, 7.88, 3.53, 9.77, 9.17];\r\n    _this.INPUT_SIZE = 416;\r\n    return _this;\r\n  }\r\n\r\n  (0, _createClass2[\"default\"])(ObjectDetectionModel, [{\r\n    key: \"_preprocess\",\r\n    value: function _preprocess(image) {\r\n      var rgb_image = tf.image.resizeBilinear(image.expandDims().toFloat(), [this.INPUT_SIZE, this.INPUT_SIZE]);\r\n      return rgb_image.reverse(-1); // RGB -> BGR\r\n    }\r\n  }, {\r\n    key: \"_postprocess\",\r\n    value: function () {\r\n      var _postprocess2 = (0, _asyncToGenerator2[\"default\"])(\r\n      /*#__PURE__*/\r\n      _regenerator[\"default\"].mark(function _callee3(outputs) {\r\n        var num_anchor, channels, height, width, num_class, boxes, scores, classes, grid_y, grid_x, offset, i, x, y, w, h, objectness, class_probabilities, max_index, selected_indices;\r\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\r\n          while (1) {\r\n            switch (_context3.prev = _context3.next) {\r\n              case 0:\r\n                // TODO: Need more efficient implmentation\r\n                num_anchor = this.ANCHORS.length / 2;\r\n                channels = outputs[0][0][0].length;\r\n                height = outputs[0].length;\r\n                width = outputs[0][0].length;\r\n                num_class = channels / num_anchor - 5;\r\n                boxes = [];\r\n                scores = [];\r\n                classes = [];\r\n\r\n                for (grid_y = 0; grid_y < height; grid_y++) {\r\n                  for (grid_x = 0; grid_x < width; grid_x++) {\r\n                    offset = 0;\r\n\r\n                    for (i = 0; i < num_anchor; i++) {\r\n                      x = (this._logistic(outputs[0][grid_y][grid_x][offset++]) + grid_x) / width;\r\n                      y = (this._logistic(outputs[0][grid_y][grid_x][offset++]) + grid_y) / height;\r\n                      w = Math.exp(outputs[0][grid_y][grid_x][offset++]) * this.ANCHORS[i * 2] / width;\r\n                      h = Math.exp(outputs[0][grid_y][grid_x][offset++]) * this.ANCHORS[i * 2 + 1] / height;\r\n                      objectness = tf.scalar(this._logistic(outputs[0][grid_y][grid_x][offset++]));\r\n                      class_probabilities = tf.tensor1d(outputs[0][grid_y][grid_x].slice(offset, offset + num_class)).softmax();\r\n                      offset += num_class;\r\n                      class_probabilities = class_probabilities.mul(objectness);\r\n                      max_index = class_probabilities.argMax();\r\n                      boxes.push([x - w / 2, y - h / 2, x + w / 2, y + h / 2]);\r\n                      scores.push(class_probabilities.max().dataSync()[0]);\r\n                      classes.push(max_index.dataSync()[0]);\r\n                    }\r\n                  }\r\n                }\r\n\r\n                boxes = tf.tensor2d(boxes);\r\n                scores = tf.tensor1d(scores);\r\n                classes = tf.tensor1d(classes);\r\n                _context3.next = 14;\r\n                return tf.image.nonMaxSuppressionAsync(boxes, scores, 10);\r\n\r\n              case 14:\r\n                selected_indices = _context3.sent;\r\n                _context3.next = 17;\r\n                return boxes.gather(selected_indices).array();\r\n\r\n              case 17:\r\n                _context3.t0 = _context3.sent;\r\n                _context3.next = 20;\r\n                return scores.gather(selected_indices).array();\r\n\r\n              case 20:\r\n                _context3.t1 = _context3.sent;\r\n                _context3.next = 23;\r\n                return classes.gather(selected_indices).array();\r\n\r\n              case 23:\r\n                _context3.t2 = _context3.sent;\r\n                return _context3.abrupt(\"return\", [_context3.t0, _context3.t1, _context3.t2]);\r\n\r\n              case 25:\r\n              case \"end\":\r\n                return _context3.stop();\r\n            }\r\n          }\r\n        }, _callee3, this);\r\n      }));\r\n\r\n      function _postprocess(_x3) {\r\n        return _postprocess2.apply(this, arguments);\r\n      }\r\n\r\n      return _postprocess;\r\n    }()\r\n  }, {\r\n    key: \"_logistic\",\r\n    value: function _logistic(x) {\r\n      if (x > 0) {\r\n        return 1 / (1 + Math.exp(-x));\r\n      } else {\r\n        var e = Math.exp(x);\r\n        return e / (1 + e);\r\n      }\r\n    }\r\n  }]);\r\n  return ObjectDetectionModel;\r\n}(Model);\r\n\r\nexports.ObjectDetectionModel = ObjectDetectionModel;\r\n\r\nvar ClassificationModel =\r\n/*#__PURE__*/\r\nfunction (_Model2) {\r\n  (0, _inherits2[\"default\"])(ClassificationModel, _Model2);\r\n\r\n  function ClassificationModel() {\r\n    var _this2;\r\n\r\n    (0, _classCallCheck2[\"default\"])(this, ClassificationModel);\r\n    _this2 = (0, _possibleConstructorReturn2[\"default\"])(this, (0, _getPrototypeOf2[\"default\"])(ClassificationModel).call(this));\r\n    _this2.INPUT_SIZE = 224;\r\n    return _this2;\r\n  }\r\n\r\n  (0, _createClass2[\"default\"])(ClassificationModel, [{\r\n    key: \"_postprocess\",\r\n    value: function () {\r\n      var _postprocess3 = (0, _asyncToGenerator2[\"default\"])(\r\n      /*#__PURE__*/\r\n      _regenerator[\"default\"].mark(function _callee4(outputs) {\r\n        return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\r\n          while (1) {\r\n            switch (_context4.prev = _context4.next) {\r\n              case 0:\r\n                return _context4.abrupt(\"return\", outputs);\r\n\r\n              case 1:\r\n              case \"end\":\r\n                return _context4.stop();\r\n            }\r\n          }\r\n        }, _callee4);\r\n      }));\r\n\r\n      function _postprocess(_x4) {\r\n        return _postprocess3.apply(this, arguments);\r\n      }\r\n\r\n      return _postprocess;\r\n    }()\r\n  }, {\r\n    key: \"_preprocess\",\r\n    value: function _preprocess(image) {\r\n      // CenterCrop\r\n      var _image$shape$slice = image.shape.slice(0, 2),\r\n          _image$shape$slice2 = (0, _slicedToArray2[\"default\"])(_image$shape$slice, 2),\r\n          h = _image$shape$slice2[0],\r\n          w = _image$shape$slice2[1];\r\n\r\n      var top = h > w ? (h - w) / 2 : 0;\r\n      var left = h > w ? 0 : (w - h) / 2;\r\n      var size = Math.min(h, w);\r\n      var rgb_image = tf.image.cropAndResize(image.expandDims().toFloat(), [[top / h, left / w, (top + size) / h, (left + size) / w]], [0], [this.INPUT_SIZE, this.INPUT_SIZE]);\r\n      return rgb_image.reverse(-1); // RGB -> BGR;\r\n    }\r\n  }]);\r\n  return ClassificationModel;\r\n}(Model);\r\n\r\nexports.ClassificationModel = ClassificationModel;"]},"metadata":{},"sourceType":"script"}