{"ast":null,"code":"var _jsxFileName = \"/home/victor/COVID-19-Coding-Fest/src/pages/scan/components/Camera.js\";\nimport React, { useState, useRef, useEffect, Fragment } from \"react\";\nimport Measure from \"react-measure\";\nimport { useUserMedia } from \"./useUserMedia\";\nimport { useCardRatio } from \"./userCardRatio\";\nimport { useOffsets } from \"./useOffSet\";\nimport { Video, Canvas, Wrapper, Container, Flash, Overlay, Button } from \"./styles\";\nimport ml5 from \"ml5\"; // import model from \"../../../data/Data\"\n\nimport * as tf from '@tensorflow/tfjs';\nimport * as mobilenet from \"@tensorflow-models/mobilenet\";\nimport { withRouter } from \"react-router-dom\"; // import { OmitProps } from \"antd/lib/transfer/renderListBody\";\n\nimport axios from \"axios\";\n\nrequire('@tensorflow/tfjs-backend-cpu');\n\nrequire('@tensorflow/tfjs-backend-webgl');\n\nconst cocoSsd = require('@tensorflow-models/coco-ssd');\n\nconst CAPTURE_OPTIONS = {\n  audio: false,\n  video: {\n    facingMode: \"environment\"\n  }\n};\n\nfunction Camera(props) {\n  const [model, setModel] = useState(null);\n  const [results, setResults] = useState([]);\n  const canvasRef = useRef();\n  const videoRef = useRef();\n  const [container, setContainer] = useState({\n    width: 0,\n    height: 0\n  });\n  const [isVideoPlaying, setIsVideoPlaying] = useState(false);\n  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);\n  const [isFlashing, setIsFlashing] = useState(false);\n  const [linkBlob, setLinkBlob] = useState(\"\");\n  const [emask_data, setEmaskData] = useState([]);\n  const mediaStream = useUserMedia(CAPTURE_OPTIONS);\n  const [aspectRatio, calculateRatio] = useCardRatio(1.586);\n  const [classifier, setClassifier] = useState(null);\n  const offsets = useOffsets(videoRef.current && videoRef.current.videoWidth, videoRef.current && videoRef.current.videoHeight, container.width, container.height);\n\n  function modelLoaded() {\n    console.log('Model Loaded!');\n    classify.predict(canvasRef.current, gotResult);\n  }\n\n  function classify(url) {\n    setClassifier(ml5.imageClassifier('MobileNet', modelLoaded));\n    classifier.classify(url, (err, results) => {\n      console.log(results);\n    });\n  }\n\n  function gotResult(error, result) {\n    if (error) {\n      console.log(error);\n    } else {\n      console.log(result);\n    }\n  }\n\n  if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n    videoRef.current.srcObject = mediaStream;\n  }\n\n  function handleResize(contentRect) {\n    setContainer({\n      width: contentRect.bounds.width,\n      height: Math.round(contentRect.bounds.width / aspectRatio)\n    });\n  }\n\n  function handleCanPlay() {\n    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);\n    setIsVideoPlaying(true);\n    videoRef.current.play();\n  }\n\n  function handleCapture() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.drawImage(videoRef.current, offsets.x, offsets.y, container.width, container.height, 0, 0, container.width, container.height);\n    var link = document.createElement(\"a\");\n    link.download = \"image.png\";\n    classify(canvasRef.current);\n    canvasRef.current.toBlob(function (blob) {\n      {\n        link.href = URL.createObjectURL(blob);\n        console.log(blob);\n        setLinkBlob(link.href); // load(link.href);\n        // setInterval(identify(link.href), 3000)\n        // const emask = document.getElementById('emask');\n        // console.log(model)\n        // model.execute(tf.browser.fromPixels(emask));\n        // console.log(link.href); // this line should be here\n      }\n    }, \"image/png\", 1); // setIsCanvasEmpty(false);\n\n    setIsFlashing(true); // setIsVideoPlaying(false)\n  }\n\n  function handleClear() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    setIsCanvasEmpty(false); // setIsFlashing(false)\n    // onClear();\n  }\n\n  useEffect(() => {\n    // console.log(props.history.location.state)\n    setTimeout(() => {\n      if (isVideoPlaying) {\n        if (isCanvasEmpty) {\n          handleCapture();\n          handleClear(); // load();\n          // axios.post(\n          // \"https://fhrs5atn73.execute-api.ap-southeast-2.amazonaws.com/dev\",\n          // {\n          //   key5: `${props.history.location.state.date}`,\n          // key2: `${props.history.location.state.address}`,\n          // key3: `${props.history.location.state.email}`,\n          // key4: `${props.history.location.state.isMapOpen}`,\n          // key1: `${props.history.location.state.key}`,\n          // key6: `${props.history.location.state.name}`,\n          // key7: `${props.history.location.state.phone}`,\n          // key8: `${props.history.location.state.status}`,\n          // key9: `${props.history.location.state.type}`\n          // }).then(res =>{console.log(res)})\n        }\n      }\n    }, 5000);\n  });\n\n  function onclick() {\n    if (localStorage.getItem(\"count_data\")) {\n      const count = parseInt(localStorage.getItem(\"count_data\"));\n      localStorage.setItem(\"count_data\", count + 1);\n    } else {\n      localStorage.setItem(\"count_data\", 1);\n    }\n\n    console.log(props.history.location.state.status);\n    console.log(props.history.location.state.phone);\n\n    if (props.history.location.state.status === \"ALERTED\") {\n      axios.post(\"https://f0mrzhjnf1.execute-api.ap-southeast-2.amazonaws.com/stage\", {\n        message: \"U should wear the meask immediately\",\n        phoneNumber: `${props.history.location.state.phone}`\n      });\n    }\n\n    props.history.push(\"/\"); // window.location.reload(false);\n  }\n\n  if (!mediaStream) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Measure, {\n    bounds: true,\n    onResize: handleResize,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 5\n    }\n  }, ({\n    measureRef\n  }) => /*#__PURE__*/React.createElement(Wrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    ref: measureRef,\n    maxHeight: videoRef.current && videoRef.current.videoHeight,\n    maxWidth: videoRef.current && videoRef.current.videoWidth,\n    style: {\n      height: `${container.height}px`\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Video, {\n    ref: videoRef,\n    hidden: !isVideoPlaying,\n    onCanPlay: handleCanPlay,\n    autoPlay: true,\n    playsInline: true,\n    muted: true,\n    style: {\n      top: `-${offsets.y}px`,\n      left: `-${offsets.x}px`\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Overlay, {\n    hidden: !isVideoPlaying,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Canvas, {\n    ref: canvasRef,\n    width: container.width,\n    height: container.height,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Flash, {\n    flash: isFlashing,\n    onAnimationEnd: () => setIsFlashing(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  })), !isCanvasEmpty && /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    style: {\n      textAlign: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 13\n    }\n  }, \"Preview\"), /*#__PURE__*/React.createElement(\"img\", {\n    id: \"emask\",\n    src: linkBlob,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Button, {\n    onClick: onclick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }\n  }, \" Go Back \")))));\n}\n\nexport default withRouter(Camera);","map":{"version":3,"sources":["/home/victor/COVID-19-Coding-Fest/src/pages/scan/components/Camera.js"],"names":["React","useState","useRef","useEffect","Fragment","Measure","useUserMedia","useCardRatio","useOffsets","Video","Canvas","Wrapper","Container","Flash","Overlay","Button","ml5","tf","mobilenet","withRouter","axios","require","cocoSsd","CAPTURE_OPTIONS","audio","video","facingMode","Camera","props","model","setModel","results","setResults","canvasRef","videoRef","container","setContainer","width","height","isVideoPlaying","setIsVideoPlaying","isCanvasEmpty","setIsCanvasEmpty","isFlashing","setIsFlashing","linkBlob","setLinkBlob","emask_data","setEmaskData","mediaStream","aspectRatio","calculateRatio","classifier","setClassifier","offsets","current","videoWidth","videoHeight","modelLoaded","console","log","classify","predict","gotResult","url","imageClassifier","err","error","result","srcObject","handleResize","contentRect","bounds","Math","round","handleCanPlay","play","handleCapture","context","getContext","drawImage","x","y","link","document","createElement","download","toBlob","blob","href","URL","createObjectURL","handleClear","clearRect","setTimeout","onclick","localStorage","getItem","count","parseInt","setItem","history","location","state","status","phone","post","message","phoneNumber","push","measureRef","top","left","textAlign"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, Fragment } from \"react\";\nimport Measure from \"react-measure\";\nimport { useUserMedia } from \"./useUserMedia\";\nimport { useCardRatio } from \"./userCardRatio\";\nimport { useOffsets } from \"./useOffSet\";\nimport {\n  Video,\n  Canvas,\n  Wrapper,\n  Container,\n  Flash,\n  Overlay,\n  Button\n} from \"./styles\";\nimport ml5 from \"ml5\"\n// import model from \"../../../data/Data\"\nimport * as tf from '@tensorflow/tfjs';\nimport * as mobilenet from \"@tensorflow-models/mobilenet\";\nimport { withRouter } from \"react-router-dom\";\n// import { OmitProps } from \"antd/lib/transfer/renderListBody\";\nimport axios from \"axios\"\nrequire('@tensorflow/tfjs-backend-cpu');\nrequire('@tensorflow/tfjs-backend-webgl');\nconst cocoSsd = require('@tensorflow-models/coco-ssd');\nconst CAPTURE_OPTIONS = {\n  audio: false,\n  video: { facingMode: \"environment\" }\n};\n\nfunction Camera(props) {\n  const [model, setModel] = useState(null)\n  const [results, setResults] = useState([])\n  const canvasRef = useRef();\n  const videoRef = useRef();\n\n  const [container, setContainer] = useState({ width: 0, height: 0 });\n  const [isVideoPlaying, setIsVideoPlaying] = useState(false);\n  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);\n  const [isFlashing, setIsFlashing] = useState(false);\n  const [linkBlob, setLinkBlob] = useState(\"\");\n  const [emask_data, setEmaskData] = useState([])\n  const mediaStream = useUserMedia(CAPTURE_OPTIONS);\n  const [aspectRatio, calculateRatio] = useCardRatio(1.586);\n  const [classifier, setClassifier] = useState(null);\n  const offsets = useOffsets(videoRef.current && videoRef.current.videoWidth,videoRef.current && videoRef.current.videoHeight,container.width,container.height);\n  function modelLoaded() {\n    console.log('Model Loaded!');\n    classify.predict(canvasRef.current, gotResult)\n  }\n  function classify(url)   {\n    setClassifier( ml5.imageClassifier('MobileNet', modelLoaded));\n    classifier.classify(url, (err, results) => {\n      console.log(results);\n    });\n  }\n  function gotResult(error, result){\n    if(error){\n      console.log(error)\n    }else{\n      console.log(result)\n    }\n  }\n\n   \n  \n   \n  if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n    videoRef.current.srcObject = mediaStream;\n  }\n \n  \n  function handleResize(contentRect) {\n    setContainer({\n      width: contentRect.bounds.width,\n      height: Math.round(contentRect.bounds.width / aspectRatio)\n    });\n  }\n\n  function handleCanPlay() {\n    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);\n    setIsVideoPlaying(true);\n    videoRef.current.play();\n  }\n\n  function handleCapture() {\n    const context = canvasRef.current.getContext(\"2d\");\n   \n    context.drawImage(\n      videoRef.current,\n      offsets.x,\n      offsets.y,\n      container.width,\n      container.height,\n      0,\n      0,\n      container.width,\n      container.height\n    );\n    var link = document.createElement(\"a\");\n  link.download = \"image.png\";\n  classify(canvasRef.current)\n    canvasRef.current.toBlob(function(blob){{\n        link.href = URL.createObjectURL(blob);\n        console.log(blob);\n        setLinkBlob(link.href);\n        // load(link.href);\n        // setInterval(identify(link.href), 3000)\n        \n        \n        // const emask = document.getElementById('emask');\n        // console.log(model)\n        // model.execute(tf.browser.fromPixels(emask));\n        // console.log(link.href); // this line should be here\n      }}, \"image/png\", 1);\n    // setIsCanvasEmpty(false);\n    setIsFlashing(true);\n    // setIsVideoPlaying(false)\n  }\n\n  function handleClear() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    setIsCanvasEmpty(false);\n    // setIsFlashing(false)\n    // onClear();\n  }\n  useEffect(() => { \n    // console.log(props.history.location.state)\n    \n\n    \n    \n    setTimeout(() => { if (isVideoPlaying){\n      if(isCanvasEmpty){\n        handleCapture();\n        handleClear();\n        // load();\n        \n        // axios.post(\n          // \"https://fhrs5atn73.execute-api.ap-southeast-2.amazonaws.com/dev\",\n          // {\n          //   key5: `${props.history.location.state.date}`,\n          // key2: `${props.history.location.state.address}`,\n          // key3: `${props.history.location.state.email}`,\n          // key4: `${props.history.location.state.isMapOpen}`,\n          // key1: `${props.history.location.state.key}`,\n          // key6: `${props.history.location.state.name}`,\n          // key7: `${props.history.location.state.phone}`,\n          // key8: `${props.history.location.state.status}`,\n          // key9: `${props.history.location.state.type}`\n          // }).then(res =>{console.log(res)})\n        \n      }\n      \n      \n      \n     \n    }}, 5000)\n      \n    }\n  );\n  function onclick(){\n    if (localStorage.getItem(\"count_data\")){\n      const count= parseInt( localStorage.getItem(\"count_data\"))\n      localStorage.setItem(\"count_data\", count+1)\n    }else{\n      localStorage.setItem(\"count_data\", 1)\n    }\n    console.log(props.history.location.state.status)\n    console.log(props.history.location.state.phone)\n    if (props.history.location.state.status === \"ALERTED\"){\n\n      axios.post(\"https://f0mrzhjnf1.execute-api.ap-southeast-2.amazonaws.com/stage\", {\n        message:\"U should wear the meask immediately\",\n        phoneNumber: `${props.history.location.state.phone}`\n      })\n    }\n    props.history.push(\"/\");\n    // window.location.reload(false);\n    \n  }\n\n\n\n  if (!mediaStream) {\n    return null;\n  }\n\n  return (\n    <Fragment>\n    <Measure bounds onResize={handleResize}>\n      {({ measureRef }) => (\n        <Wrapper>\n          <Container\n            ref={measureRef}\n            maxHeight={videoRef.current && videoRef.current.videoHeight}\n            maxWidth={videoRef.current && videoRef.current.videoWidth}\n            style={{\n              height: `${container.height}px`\n            }}\n          >\n            <Video\n              ref={videoRef}\n              hidden={!isVideoPlaying}\n              onCanPlay={handleCanPlay}\n              autoPlay\n              playsInline\n              muted\n              style={{\n                top: `-${offsets.y}px`,\n                left: `-${offsets.x}px`\n              }}\n            />\n\n            <Overlay hidden={!isVideoPlaying} />\n\n            <Canvas\n              ref={canvasRef}\n              width={container.width}\n              height={container.height}\n            />\n\n            <Flash\n              flash={isFlashing}\n              onAnimationEnd={() => setIsFlashing(false)}\n            />\n          </Container>\n\n         \n          {!isCanvasEmpty && \n            <Fragment>\n            <div>\n            <h2 style= {{textAlign:\"center\"}}>Preview</h2>\n            <img id = \"emask\" src = {linkBlob}/>\n            </div>\n            <Button onClick= {onclick} > Go Back </Button>\n            </Fragment>\n          }\n          \n\n        </Wrapper>\n      )}\n    </Measure>\n    \n    </Fragment>\n  );\n}\nexport default withRouter(Camera)"]},"metadata":{},"sourceType":"module"}