{"ast":null,"code":"import _slicedToArray from\"/home/victor/COVID-19-Coding-Fest/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect}from\"react\";import Measure from\"react-measure\";import{useUserMedia}from\"./useUserMedia\";import{useCardRatio}from\"./userCardRatio\";import{useOffsets}from\"./useOffSet\";import{Video,Canvas,Wrapper,Container,Flash,Overlay,Button}from\"./styles\";import{withRouter}from\"react-router-dom\";import{OmitProps}from\"antd/lib/transfer/renderListBody\";var CAPTURE_OPTIONS={audio:false,video:{facingMode:\"environment\"}};function Camera(props){var canvasRef=useRef();var videoRef=useRef();var _useState=useState({width:0,height:0}),_useState2=_slicedToArray(_useState,2),container=_useState2[0],setContainer=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isVideoPlaying=_useState4[0],setIsVideoPlaying=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),isCanvasEmpty=_useState6[0],setIsCanvasEmpty=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isFlashing=_useState8[0],setIsFlashing=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),linkBlob=_useState10[0],setLinkBlob=_useState10[1];var mediaStream=useUserMedia(CAPTURE_OPTIONS);var _useCardRatio=useCardRatio(1.586),_useCardRatio2=_slicedToArray(_useCardRatio,2),aspectRatio=_useCardRatio2[0],calculateRatio=_useCardRatio2[1];var offsets=useOffsets(videoRef.current&&videoRef.current.videoWidth,videoRef.current&&videoRef.current.videoHeight,container.width,container.height);if(mediaStream&&videoRef.current&&!videoRef.current.srcObject){videoRef.current.srcObject=mediaStream;}function handleResize(contentRect){setContainer({width:contentRect.bounds.width,height:Math.round(contentRect.bounds.width/aspectRatio)});}function handleCanPlay(){calculateRatio(videoRef.current.videoHeight,videoRef.current.videoWidth);setIsVideoPlaying(true);videoRef.current.play();}function handleCapture(){var context=canvasRef.current.getContext(\"2d\");context.drawImage(videoRef.current,offsets.x,offsets.y,container.width,container.height,0,0,container.width,container.height);var link=document.createElement(\"a\");link.download=\"image.png\";canvasRef.current.toBlob(function(blob){{link.href=URL.createObjectURL(blob);console.log(blob);setLinkBlob(link.href);console.log(link.href);// this line should be here\n}},\"image/png\",1);setIsCanvasEmpty(false);setIsFlashing(true);}function handleClear(){var context=canvasRef.current.getContext(\"2d\");context.clearRect(0,0,canvasRef.current.width,canvasRef.current.height);setIsCanvasEmpty(false);// onClear();\n}useEffect(function(){setTimeout(function(){if(isVideoPlaying){if(isCanvasEmpty){handleCapture();handleClear();}}},2000);});if(!mediaStream){return null;}return React.createElement(Measure,{bounds:true,onResize:handleResize},function(_ref){var measureRef=_ref.measureRef;return React.createElement(Wrapper,null,React.createElement(Container,{ref:measureRef,maxHeight:videoRef.current&&videoRef.current.videoHeight,maxWidth:videoRef.current&&videoRef.current.videoWidth,style:{height:\"\".concat(container.height,\"px\")}},React.createElement(Video,{ref:videoRef,hidden:!isVideoPlaying,onCanPlay:handleCanPlay,autoPlay:true,playsInline:true,muted:true,style:{top:\"-\".concat(offsets.y,\"px\"),left:\"-\".concat(offsets.x,\"px\")}}),React.createElement(Overlay,{hidden:!isVideoPlaying}),React.createElement(Canvas,{ref:canvasRef,width:container.width,height:container.height}),React.createElement(Flash,{flash:isFlashing,onAnimationEnd:function onAnimationEnd(){return setIsFlashing(false);}})),isVideoPlaying&&React.createElement(Button,{onClick:handleCapture},\"Take a picture\"),!isCanvasEmpty&&React.createElement(\"div\",null,React.createElement(\"h2\",{style:{textAlign:\"center\"}},\"Preview\"),React.createElement(\"img\",{src:linkBlob})));});}export default withRouter(Camera);","map":{"version":3,"sources":["/home/victor/COVID-19-Coding-Fest/src/pages/scan/components/Camera.js"],"names":["React","useState","useRef","useEffect","Measure","useUserMedia","useCardRatio","useOffsets","Video","Canvas","Wrapper","Container","Flash","Overlay","Button","withRouter","OmitProps","CAPTURE_OPTIONS","audio","video","facingMode","Camera","props","canvasRef","videoRef","width","height","container","setContainer","isVideoPlaying","setIsVideoPlaying","isCanvasEmpty","setIsCanvasEmpty","isFlashing","setIsFlashing","linkBlob","setLinkBlob","mediaStream","aspectRatio","calculateRatio","offsets","current","videoWidth","videoHeight","srcObject","handleResize","contentRect","bounds","Math","round","handleCanPlay","play","handleCapture","context","getContext","drawImage","x","y","link","document","createElement","download","toBlob","blob","href","URL","createObjectURL","console","log","handleClear","clearRect","setTimeout","measureRef","top","left","textAlign"],"mappings":"oHAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,MAA1B,CAAkCC,SAAlC,KAAmD,OAAnD,CACA,MAAOC,CAAAA,OAAP,KAAoB,eAApB,CACA,OAASC,YAAT,KAA6B,gBAA7B,CACA,OAASC,YAAT,KAA6B,iBAA7B,CACA,OAASC,UAAT,KAA2B,aAA3B,CACA,OACEC,KADF,CAEEC,MAFF,CAGEC,OAHF,CAIEC,SAJF,CAKEC,KALF,CAMEC,OANF,CAOEC,MAPF,KAQO,UARP,CASA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,SAAT,KAA0B,kCAA1B,CAEA,GAAMC,CAAAA,eAAe,CAAG,CACtBC,KAAK,CAAE,KADe,CAEtBC,KAAK,CAAE,CAAEC,UAAU,CAAE,aAAd,CAFe,CAAxB,CAKA,QAASC,CAAAA,MAAT,CAAgBC,KAAhB,CAAuB,CACrB,GAAMC,CAAAA,SAAS,CAAGrB,MAAM,EAAxB,CACA,GAAMsB,CAAAA,QAAQ,CAAGtB,MAAM,EAAvB,CAFqB,cAIaD,QAAQ,CAAC,CAAEwB,KAAK,CAAE,CAAT,CAAYC,MAAM,CAAE,CAApB,CAAD,CAJrB,wCAIdC,SAJc,eAIHC,YAJG,8BAKuB3B,QAAQ,CAAC,KAAD,CAL/B,yCAKd4B,cALc,eAKEC,iBALF,8BAMqB7B,QAAQ,CAAC,IAAD,CAN7B,yCAMd8B,aANc,eAMCC,gBAND,8BAOe/B,QAAQ,CAAC,KAAD,CAPvB,yCAOdgC,UAPc,eAOFC,aAPE,8BAQWjC,QAAQ,CAAC,EAAD,CARnB,0CAQdkC,QARc,gBAQJC,WARI,gBASrB,GAAMC,CAAAA,WAAW,CAAGhC,YAAY,CAACY,eAAD,CAAhC,CATqB,kBAUiBX,YAAY,CAAC,KAAD,CAV7B,gDAUdgC,WAVc,mBAUDC,cAVC,mBAWrB,GAAMC,CAAAA,OAAO,CAAGjC,UAAU,CAACiB,QAAQ,CAACiB,OAAT,EAAoBjB,QAAQ,CAACiB,OAAT,CAAiBC,UAAtC,CAAiDlB,QAAQ,CAACiB,OAAT,EAAoBjB,QAAQ,CAACiB,OAAT,CAAiBE,WAAtF,CAAkGhB,SAAS,CAACF,KAA5G,CAAkHE,SAAS,CAACD,MAA5H,CAA1B,CAEA,GAAIW,WAAW,EAAIb,QAAQ,CAACiB,OAAxB,EAAmC,CAACjB,QAAQ,CAACiB,OAAT,CAAiBG,SAAzD,CAAoE,CAClEpB,QAAQ,CAACiB,OAAT,CAAiBG,SAAjB,CAA6BP,WAA7B,CACD,CAGD,QAASQ,CAAAA,YAAT,CAAsBC,WAAtB,CAAmC,CACjClB,YAAY,CAAC,CACXH,KAAK,CAAEqB,WAAW,CAACC,MAAZ,CAAmBtB,KADf,CAEXC,MAAM,CAAEsB,IAAI,CAACC,KAAL,CAAWH,WAAW,CAACC,MAAZ,CAAmBtB,KAAnB,CAA2Ba,WAAtC,CAFG,CAAD,CAAZ,CAID,CAED,QAASY,CAAAA,aAAT,EAAyB,CACvBX,cAAc,CAACf,QAAQ,CAACiB,OAAT,CAAiBE,WAAlB,CAA+BnB,QAAQ,CAACiB,OAAT,CAAiBC,UAAhD,CAAd,CACAZ,iBAAiB,CAAC,IAAD,CAAjB,CACAN,QAAQ,CAACiB,OAAT,CAAiBU,IAAjB,GACD,CAED,QAASC,CAAAA,aAAT,EAAyB,CACvB,GAAMC,CAAAA,OAAO,CAAG9B,SAAS,CAACkB,OAAV,CAAkBa,UAAlB,CAA6B,IAA7B,CAAhB,CAEAD,OAAO,CAACE,SAAR,CACE/B,QAAQ,CAACiB,OADX,CAEED,OAAO,CAACgB,CAFV,CAGEhB,OAAO,CAACiB,CAHV,CAIE9B,SAAS,CAACF,KAJZ,CAKEE,SAAS,CAACD,MALZ,CAME,CANF,CAOE,CAPF,CAQEC,SAAS,CAACF,KARZ,CASEE,SAAS,CAACD,MATZ,EAWA,GAAIgC,CAAAA,IAAI,CAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAX,CACFF,IAAI,CAACG,QAAL,CAAgB,WAAhB,CACEtC,SAAS,CAACkB,OAAV,CAAkBqB,MAAlB,CAAyB,SAASC,IAAT,CAAc,CAAC,CACpCL,IAAI,CAACM,IAAL,CAAYC,GAAG,CAACC,eAAJ,CAAoBH,IAApB,CAAZ,CACAI,OAAO,CAACC,GAAR,CAAYL,IAAZ,EACA3B,WAAW,CAACsB,IAAI,CAACM,IAAN,CAAX,CACAG,OAAO,CAACC,GAAR,CAAYV,IAAI,CAACM,IAAjB,EAAwB;AACzB,CAAC,CALJ,CAKM,WALN,CAKmB,CALnB,EAMAhC,gBAAgB,CAAC,KAAD,CAAhB,CACAE,aAAa,CAAC,IAAD,CAAb,CACD,CAED,QAASmC,CAAAA,WAAT,EAAuB,CACrB,GAAMhB,CAAAA,OAAO,CAAG9B,SAAS,CAACkB,OAAV,CAAkBa,UAAlB,CAA6B,IAA7B,CAAhB,CACAD,OAAO,CAACiB,SAAR,CAAkB,CAAlB,CAAqB,CAArB,CAAwB/C,SAAS,CAACkB,OAAV,CAAkBhB,KAA1C,CAAiDF,SAAS,CAACkB,OAAV,CAAkBf,MAAnE,EACAM,gBAAgB,CAAC,KAAD,CAAhB,CACA;AACD,CACD7B,SAAS,CAAC,UAAM,CACdoE,UAAU,CAAC,UAAM,CAAE,GAAI1C,cAAJ,CAAmB,CACpC,GAAGE,aAAH,CAAiB,CACfqB,aAAa,GACbiB,WAAW,GACZ,CAIF,CAAC,CARQ,CAQN,IARM,CAAV,CAUC,CAXM,CAAT,CAgBA,GAAI,CAAChC,WAAL,CAAkB,CAChB,MAAO,KAAP,CACD,CAED,MACE,qBAAC,OAAD,EAAS,MAAM,KAAf,CAAgB,QAAQ,CAAEQ,YAA1B,EACG,kBAAG2B,CAAAA,UAAH,MAAGA,UAAH,OACC,qBAAC,OAAD,MACE,oBAAC,SAAD,EACE,GAAG,CAAEA,UADP,CAEE,SAAS,CAAEhD,QAAQ,CAACiB,OAAT,EAAoBjB,QAAQ,CAACiB,OAAT,CAAiBE,WAFlD,CAGE,QAAQ,CAAEnB,QAAQ,CAACiB,OAAT,EAAoBjB,QAAQ,CAACiB,OAAT,CAAiBC,UAHjD,CAIE,KAAK,CAAE,CACLhB,MAAM,WAAKC,SAAS,CAACD,MAAf,MADD,CAJT,EAQE,oBAAC,KAAD,EACE,GAAG,CAAEF,QADP,CAEE,MAAM,CAAE,CAACK,cAFX,CAGE,SAAS,CAAEqB,aAHb,CAIE,QAAQ,KAJV,CAKE,WAAW,KALb,CAME,KAAK,KANP,CAOE,KAAK,CAAE,CACLuB,GAAG,YAAMjC,OAAO,CAACiB,CAAd,MADE,CAELiB,IAAI,YAAMlC,OAAO,CAACgB,CAAd,MAFC,CAPT,EARF,CAqBE,oBAAC,OAAD,EAAS,MAAM,CAAE,CAAC3B,cAAlB,EArBF,CAuBE,oBAAC,MAAD,EACE,GAAG,CAAEN,SADP,CAEE,KAAK,CAAEI,SAAS,CAACF,KAFnB,CAGE,MAAM,CAAEE,SAAS,CAACD,MAHpB,EAvBF,CA6BE,oBAAC,KAAD,EACE,KAAK,CAAEO,UADT,CAEE,cAAc,CAAE,gCAAMC,CAAAA,aAAa,CAAC,KAAD,CAAnB,EAFlB,EA7BF,CADF,CAoCGL,cAAc,EACb,oBAAC,MAAD,EAAS,OAAO,CAAEuB,aAAlB,mBArCJ,CAyCG,CAACrB,aAAD,EACC,+BACA,0BAAI,KAAK,CAAG,CAAC4C,SAAS,CAAC,QAAX,CAAZ,YADA,CAEA,2BAAK,GAAG,CAAIxC,QAAZ,EAFA,CA1CJ,CADD,EADH,CADF,CAwDD,CACD,cAAepB,CAAAA,UAAU,CAACM,MAAD,CAAzB","sourcesContent":["import React, { useState, useRef, useEffect } from \"react\";\nimport Measure from \"react-measure\";\nimport { useUserMedia } from \"./useUserMedia\";\nimport { useCardRatio } from \"./userCardRatio\";\nimport { useOffsets } from \"./useOffSet\";\nimport {\n  Video,\n  Canvas,\n  Wrapper,\n  Container,\n  Flash,\n  Overlay,\n  Button\n} from \"./styles\";\nimport { withRouter } from \"react-router-dom\";\nimport { OmitProps } from \"antd/lib/transfer/renderListBody\";\n\nconst CAPTURE_OPTIONS = {\n  audio: false,\n  video: { facingMode: \"environment\" }\n};\n\nfunction Camera(props) {\n  const canvasRef = useRef();\n  const videoRef = useRef();\n\n  const [container, setContainer] = useState({ width: 0, height: 0 });\n  const [isVideoPlaying, setIsVideoPlaying] = useState(false);\n  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);\n  const [isFlashing, setIsFlashing] = useState(false);\n  const [linkBlob, setLinkBlob] = useState(\"\");\n  const mediaStream = useUserMedia(CAPTURE_OPTIONS);\n  const [aspectRatio, calculateRatio] = useCardRatio(1.586);\n  const offsets = useOffsets(videoRef.current && videoRef.current.videoWidth,videoRef.current && videoRef.current.videoHeight,container.width,container.height);\n\n  if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n    videoRef.current.srcObject = mediaStream;\n  }\n \n\n  function handleResize(contentRect) {\n    setContainer({\n      width: contentRect.bounds.width,\n      height: Math.round(contentRect.bounds.width / aspectRatio)\n    });\n  }\n\n  function handleCanPlay() {\n    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);\n    setIsVideoPlaying(true);\n    videoRef.current.play();\n  }\n\n  function handleCapture() {\n    const context = canvasRef.current.getContext(\"2d\");\n\n    context.drawImage(\n      videoRef.current,\n      offsets.x,\n      offsets.y,\n      container.width,\n      container.height,\n      0,\n      0,\n      container.width,\n      container.height\n    );\n    var link = document.createElement(\"a\");\n  link.download = \"image.png\";\n    canvasRef.current.toBlob(function(blob){{\n        link.href = URL.createObjectURL(blob);\n        console.log(blob);\n        setLinkBlob(link.href)\n        console.log(link.href); // this line should be here\n      }}, \"image/png\", 1);\n    setIsCanvasEmpty(false);\n    setIsFlashing(true);\n  }\n\n  function handleClear() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    setIsCanvasEmpty(false);\n    // onClear();\n  }\n  useEffect(() => {   \n    setTimeout(() => { if (isVideoPlaying){\n      if(isCanvasEmpty){\n        handleCapture();\n        handleClear()\n      }\n      \n      \n     \n    }}, 2000)\n      \n    }\n  );\n\n\n\n  if (!mediaStream) {\n    return null;\n  }\n\n  return (\n    <Measure bounds onResize={handleResize}>\n      {({ measureRef }) => (\n        <Wrapper>\n          <Container\n            ref={measureRef}\n            maxHeight={videoRef.current && videoRef.current.videoHeight}\n            maxWidth={videoRef.current && videoRef.current.videoWidth}\n            style={{\n              height: `${container.height}px`\n            }}\n          >\n            <Video\n              ref={videoRef}\n              hidden={!isVideoPlaying}\n              onCanPlay={handleCanPlay}\n              autoPlay\n              playsInline\n              muted\n              style={{\n                top: `-${offsets.y}px`,\n                left: `-${offsets.x}px`\n              }}\n            />\n\n            <Overlay hidden={!isVideoPlaying} />\n\n            <Canvas\n              ref={canvasRef}\n              width={container.width}\n              height={container.height}\n            />\n\n            <Flash\n              flash={isFlashing}\n              onAnimationEnd={() => setIsFlashing(false)}\n            />\n          </Container>\n\n          {isVideoPlaying && (\n            <Button  onClick={handleCapture }>\n               Take a picture\n            </Button>\n          )}\n          {!isCanvasEmpty && \n            <div>\n            <h2 style= {{textAlign:\"center\"}}>Preview</h2>\n            <img src = {linkBlob}/>\n            </div>\n          }\n          \n\n        </Wrapper>\n      )}\n    </Measure>\n  );\n}\nexport default withRouter(Camera)"]},"metadata":{},"sourceType":"module"}