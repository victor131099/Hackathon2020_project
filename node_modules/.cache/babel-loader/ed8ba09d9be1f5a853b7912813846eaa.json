{"ast":null,"code":"import _slicedToArray from \"/home/victor/COVID-19-Coding-Fest/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/victor/COVID-19-Coding-Fest/src/pages/scan/components/Camera.js\";\nimport React, { useState, useRef, useEffect, Fragment } from \"react\";\nimport Measure from \"react-measure\";\nimport { useUserMedia } from \"./useUserMedia\";\nimport { useCardRatio } from \"./userCardRatio\";\nimport { useOffsets } from \"./useOffSet\";\nimport { Video, Canvas, Wrapper, Container, Flash, Overlay, Button } from \"./styles\";\nimport { withRouter } from \"react-router-dom\";\nimport { OmitProps } from \"antd/lib/transfer/renderListBody\";\nimport axios from \"axios\";\nconst CAPTURE_OPTIONS = {\n  audio: false,\n  video: {\n    facingMode: \"environment\"\n  }\n};\n\nfunction Camera(props) {\n  const canvasRef = useRef();\n  const videoRef = useRef();\n\n  const _useState = useState({\n    width: 0,\n    height: 0\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        container = _useState2[0],\n        setContainer = _useState2[1];\n\n  const _useState3 = useState(false),\n        _useState4 = _slicedToArray(_useState3, 2),\n        isVideoPlaying = _useState4[0],\n        setIsVideoPlaying = _useState4[1];\n\n  const _useState5 = useState(true),\n        _useState6 = _slicedToArray(_useState5, 2),\n        isCanvasEmpty = _useState6[0],\n        setIsCanvasEmpty = _useState6[1];\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        isFlashing = _useState8[0],\n        setIsFlashing = _useState8[1];\n\n  const _useState9 = useState(\"\"),\n        _useState10 = _slicedToArray(_useState9, 2),\n        linkBlob = _useState10[0],\n        setLinkBlob = _useState10[1];\n\n  const _useState11 = useState([]),\n        _useState12 = _slicedToArray(_useState11, 2),\n        emask_data = _useState12[0],\n        setEmaskData = _useState12[1];\n\n  const mediaStream = useUserMedia(CAPTURE_OPTIONS);\n\n  const _useCardRatio = useCardRatio(1.586),\n        _useCardRatio2 = _slicedToArray(_useCardRatio, 2),\n        aspectRatio = _useCardRatio2[0],\n        calculateRatio = _useCardRatio2[1];\n\n  const offsets = useOffsets(videoRef.current && videoRef.current.videoWidth, videoRef.current && videoRef.current.videoHeight, container.width, container.height);\n\n  if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n    videoRef.current.srcObject = mediaStream;\n  }\n\n  function handleResize(contentRect) {\n    setContainer({\n      width: contentRect.bounds.width,\n      height: Math.round(contentRect.bounds.width / aspectRatio)\n    });\n  }\n\n  function handleCanPlay() {\n    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);\n    setIsVideoPlaying(true);\n    videoRef.current.play();\n  }\n\n  function handleCapture() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.drawImage(videoRef.current, offsets.x, offsets.y, container.width, container.height, 0, 0, container.width, container.height);\n    var link = document.createElement(\"a\");\n    link.download = \"image.png\";\n    canvasRef.current.toBlob(function (blob) {\n      {\n        link.href = URL.createObjectURL(blob);\n        console.log(blob);\n        setLinkBlob(link.href);\n        console.log(link.href); // this line should be here\n      }\n    }, \"image/png\", 1);\n    setIsCanvasEmpty(false);\n    setIsFlashing(true);\n  }\n\n  function handleClear() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    setIsCanvasEmpty(false); // onClear();\n  }\n\n  useEffect(() => {\n    // console.log(props.history.location.state)\n    setTimeout(() => {\n      if (isVideoPlaying) {\n        if (isCanvasEmpty) {\n          handleCapture();\n          handleClear();\n\n          if (sessionStorage.getItem(\"count_data\")) {\n            const count = parseInt(sessionStorage.getItem(\"count_data\"));\n            sessionStorage.setItem(\"count_data\", count + 1);\n          } else {\n            sessionStorage.setItem(\"count_data\", 1);\n          }\n\n          axios.post(\"https://fhrs5atn73.execute-api.ap-southeast-2.amazonaws.com/dev\", {\n            key5: \"\".concat(props.history.location.state.date),\n            key2: \"\".concat(props.history.location.state.address),\n            key3: \"\".concat(props.history.location.state.email),\n            key4: \"\".concat(props.history.location.state.isMapOpen),\n            key1: \"\".concat(props.history.location.state.key),\n            key6: \"\".concat(props.history.location.state.name),\n            key7: \"\".concat(props.history.location.state.phone),\n            key8: \"\".concat(props.history.location.state.status),\n            key9: \"\".concat(props.history.location.state.type)\n          }).then(res => {\n            console.log(res);\n          });\n        }\n      }\n    }, 2000);\n  });\n\n  function onclick() {\n    console.log(props.history.location.state.status);\n    console.log(props.history.location.state.phone);\n\n    if (props.history.location.state.status === \"ALERTED\") {\n      axios.post(\"https://f0mrzhjnf1.execute-api.ap-southeast-2.amazonaws.com/stage\", {\n        message: \"U should wear the meask immediately\",\n        phoneNumber: \"\".concat(props.history.location.state.phone)\n      });\n    }\n\n    props.history.push(\"/\");\n    window.onload();\n  }\n\n  if (!mediaStream) {\n    return null;\n  }\n\n  return React.createElement(Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, React.createElement(Measure, {\n    bounds: true,\n    onResize: handleResize,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, ({\n    measureRef\n  }) => React.createElement(Wrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151\n    },\n    __self: this\n  }, React.createElement(Container, {\n    ref: measureRef,\n    maxHeight: videoRef.current && videoRef.current.videoHeight,\n    maxWidth: videoRef.current && videoRef.current.videoWidth,\n    style: {\n      height: \"\".concat(container.height, \"px\")\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152\n    },\n    __self: this\n  }, React.createElement(Video, {\n    ref: videoRef,\n    hidden: !isVideoPlaying,\n    onCanPlay: handleCanPlay,\n    autoPlay: true,\n    playsInline: true,\n    muted: true,\n    style: {\n      top: \"-\".concat(offsets.y, \"px\"),\n      left: \"-\".concat(offsets.x, \"px\")\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }), React.createElement(Overlay, {\n    hidden: !isVideoPlaying,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }), React.createElement(Canvas, {\n    ref: canvasRef,\n    width: container.width,\n    height: container.height,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175\n    },\n    __self: this\n  }), React.createElement(Flash, {\n    flash: isFlashing,\n    onAnimationEnd: () => setIsFlashing(false),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181\n    },\n    __self: this\n  })), isVideoPlaying && React.createElement(Button, {\n    onClick: handleCapture,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }, \"Take a picture\"), !isCanvasEmpty && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    style: {\n      textAlign: \"center\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194\n    },\n    __self: this\n  }, \"Preview\"), React.createElement(\"img\", {\n    src: linkBlob,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  })))), React.createElement(Button, {\n    onClick: onclick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, \" Go Back \"));\n}\n\nexport default withRouter(Camera);","map":{"version":3,"sources":["/home/victor/COVID-19-Coding-Fest/src/pages/scan/components/Camera.js"],"names":["React","useState","useRef","useEffect","Fragment","Measure","useUserMedia","useCardRatio","useOffsets","Video","Canvas","Wrapper","Container","Flash","Overlay","Button","withRouter","OmitProps","axios","CAPTURE_OPTIONS","audio","video","facingMode","Camera","props","canvasRef","videoRef","width","height","container","setContainer","isVideoPlaying","setIsVideoPlaying","isCanvasEmpty","setIsCanvasEmpty","isFlashing","setIsFlashing","linkBlob","setLinkBlob","emask_data","setEmaskData","mediaStream","aspectRatio","calculateRatio","offsets","current","videoWidth","videoHeight","srcObject","handleResize","contentRect","bounds","Math","round","handleCanPlay","play","handleCapture","context","getContext","drawImage","x","y","link","document","createElement","download","toBlob","blob","href","URL","createObjectURL","console","log","handleClear","clearRect","setTimeout","sessionStorage","getItem","count","parseInt","setItem","post","key5","history","location","state","date","key2","address","key3","email","key4","isMapOpen","key1","key","key6","name","key7","phone","key8","status","key9","type","then","res","onclick","message","phoneNumber","push","window","onload","measureRef","top","left","textAlign"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, Fragment } from \"react\";\nimport Measure from \"react-measure\";\nimport { useUserMedia } from \"./useUserMedia\";\nimport { useCardRatio } from \"./userCardRatio\";\nimport { useOffsets } from \"./useOffSet\";\nimport {\n  Video,\n  Canvas,\n  Wrapper,\n  Container,\n  Flash,\n  Overlay,\n  Button\n} from \"./styles\";\nimport { withRouter } from \"react-router-dom\";\nimport { OmitProps } from \"antd/lib/transfer/renderListBody\";\nimport axios from \"axios\"\nconst CAPTURE_OPTIONS = {\n  audio: false,\n  video: { facingMode: \"environment\" }\n};\n\nfunction Camera(props) {\n  const canvasRef = useRef();\n  const videoRef = useRef();\n\n  const [container, setContainer] = useState({ width: 0, height: 0 });\n  const [isVideoPlaying, setIsVideoPlaying] = useState(false);\n  const [isCanvasEmpty, setIsCanvasEmpty] = useState(true);\n  const [isFlashing, setIsFlashing] = useState(false);\n  const [linkBlob, setLinkBlob] = useState(\"\");\n  const [emask_data, setEmaskData] = useState([])\n  const mediaStream = useUserMedia(CAPTURE_OPTIONS);\n  const [aspectRatio, calculateRatio] = useCardRatio(1.586);\n  \n  const offsets = useOffsets(videoRef.current && videoRef.current.videoWidth,videoRef.current && videoRef.current.videoHeight,container.width,container.height);\n\n  if (mediaStream && videoRef.current && !videoRef.current.srcObject) {\n    videoRef.current.srcObject = mediaStream;\n  }\n \n\n  function handleResize(contentRect) {\n    setContainer({\n      width: contentRect.bounds.width,\n      height: Math.round(contentRect.bounds.width / aspectRatio)\n    });\n  }\n\n  function handleCanPlay() {\n    calculateRatio(videoRef.current.videoHeight, videoRef.current.videoWidth);\n    setIsVideoPlaying(true);\n    videoRef.current.play();\n  }\n\n  function handleCapture() {\n    const context = canvasRef.current.getContext(\"2d\");\n\n    context.drawImage(\n      videoRef.current,\n      offsets.x,\n      offsets.y,\n      container.width,\n      container.height,\n      0,\n      0,\n      container.width,\n      container.height\n    );\n    var link = document.createElement(\"a\");\n  link.download = \"image.png\";\n    canvasRef.current.toBlob(function(blob){{\n        link.href = URL.createObjectURL(blob);\n        console.log(blob);\n        setLinkBlob(link.href)\n        console.log(link.href); // this line should be here\n      }}, \"image/png\", 1);\n    setIsCanvasEmpty(false);\n    setIsFlashing(true);\n  }\n\n  function handleClear() {\n    const context = canvasRef.current.getContext(\"2d\");\n    context.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    setIsCanvasEmpty(false);\n    // onClear();\n  }\n  useEffect(() => { \n    // console.log(props.history.location.state)\n    \n\n    \n    \n    setTimeout(() => { if (isVideoPlaying){\n      if(isCanvasEmpty){\n        handleCapture();\n        handleClear();\n        if (sessionStorage.getItem(\"count_data\")){\n          const count= parseInt( sessionStorage.getItem(\"count_data\"))\n          sessionStorage.setItem(\"count_data\", count+1)\n        }else{\n          sessionStorage.setItem(\"count_data\", 1)\n        }\n        axios.post(\n          \"https://fhrs5atn73.execute-api.ap-southeast-2.amazonaws.com/dev\",\n          {\n            key5: `${props.history.location.state.date}`,\n          key2: `${props.history.location.state.address}`,\n          key3: `${props.history.location.state.email}`,\n          key4: `${props.history.location.state.isMapOpen}`,\n          key1: `${props.history.location.state.key}`,\n          key6: `${props.history.location.state.name}`,\n          key7: `${props.history.location.state.phone}`,\n          key8: `${props.history.location.state.status}`,\n          key9: `${props.history.location.state.type}`\n          }).then(res =>{console.log(res)})\n        \n      }\n      \n      \n      \n     \n    }}, 2000)\n      \n    }\n  );\n  function onclick(){\n    console.log(props.history.location.state.status)\n    console.log(props.history.location.state.phone)\n    if (props.history.location.state.status === \"ALERTED\"){\n\n      axios.post(\"https://f0mrzhjnf1.execute-api.ap-southeast-2.amazonaws.com/stage\", {\n        message:\"U should wear the meask immediately\",\n        phoneNumber: `${props.history.location.state.phone}`\n      })\n    }\n    props.history.push(\"/\");\n    window.onload()\n  }\n\n\n\n  if (!mediaStream) {\n    return null;\n  }\n\n  return (\n    <Fragment>\n    <Measure bounds onResize={handleResize}>\n      {({ measureRef }) => (\n        <Wrapper>\n          <Container\n            ref={measureRef}\n            maxHeight={videoRef.current && videoRef.current.videoHeight}\n            maxWidth={videoRef.current && videoRef.current.videoWidth}\n            style={{\n              height: `${container.height}px`\n            }}\n          >\n            <Video\n              ref={videoRef}\n              hidden={!isVideoPlaying}\n              onCanPlay={handleCanPlay}\n              autoPlay\n              playsInline\n              muted\n              style={{\n                top: `-${offsets.y}px`,\n                left: `-${offsets.x}px`\n              }}\n            />\n\n            <Overlay hidden={!isVideoPlaying} />\n\n            <Canvas\n              ref={canvasRef}\n              width={container.width}\n              height={container.height}\n            />\n\n            <Flash\n              flash={isFlashing}\n              onAnimationEnd={() => setIsFlashing(false)}\n            />\n          </Container>\n\n          {isVideoPlaying && (\n            <Button  onClick={handleCapture }>\n               Take a picture\n            </Button>\n          )}\n          {!isCanvasEmpty && \n            <div>\n            <h2 style= {{textAlign:\"center\"}}>Preview</h2>\n            <img src = {linkBlob}/>\n            </div>\n          }\n          \n\n        </Wrapper>\n      )}\n    </Measure>\n    <Button onClick= {onclick} > Go Back </Button>\n    </Fragment>\n  );\n}\nexport default withRouter(Camera)"]},"metadata":{},"sourceType":"module"}