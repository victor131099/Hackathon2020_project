!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={})}(this,(function(e){"use strict";let t,r,n="view",i=/[[\]{}]/,o={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};function s(e,t,r,n,i){let o,s=0,l=e.length;for(;t<l;++t){if(o=e[t],!s&&o===r)return t;i&&i.indexOf(o)>=0?--s:n&&n.indexOf(o)>=0&&++s}return t}function l(e){let t=[],r=0,n=e.length,i=0;for(;i<n;)i=s(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function f(e){return"["===e[0]?function(e){let t,r,n=e.length,i=1;if(i=s(e,i,"]","[","]"),i===n)throw"Empty between selector: "+e;if(t=l(e.substring(1,i)),2!==t.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(i+1).trim())[0])throw"Expected '>' after between selector: "+e;if(t=t.map(f),r=f(e.slice(1).trim()),r.between)return{between:t,stream:r};r.between=t;return r}(e):function(e){let n,o,l={source:t},f=[],c=[0,0],u=0,h=0,a=e.length,p=0;if("}"===e[a-1]){if(p=e.lastIndexOf("{"),!(p>=0))throw"Unmatched right brace: "+e;try{c=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((function(t){const r=+t;if(r!=r)throw e;return r}))}(e.substring(p+1,a-1))}catch(t){throw"Invalid throttle specification: "+e}a=(e=e.slice(0,p).trim()).length,p=0}if(!a)throw e;"@"===e[0]&&(u=++p);n=s(e,p,":"),n<a&&(f.push(e.substring(h,n).trim()),h=p=++n);if(p=s(e,p,"["),p===a)f.push(e.substring(h,a).trim());else if(f.push(e.substring(h,p).trim()),o=[],h=++p,h===a)throw"Unmatched left bracket: "+e;for(;p<a;){if(p=s(e,p,"]"),p===a)throw"Unmatched left bracket: "+e;if(o.push(e.substring(h,p).trim()),p<a-1&&"["!==e[++p])throw"Expected left bracket: "+e;h=++p}if(!(a=f.length)||i.test(f[a-1]))throw"Invalid event selector: "+e;a>1?(l.type=f[1],u?l.markname=f[0].slice(1):(m=f[0],r[m]?l.marktype=f[0]:l.source=f[0])):l.type=f[0];var m;"!"===l.type.slice(-1)&&(l.consume=!0,l.type=l.type.slice(0,-1));null!=o&&(l.filter=o);c[0]&&(l.throttle=c[0]);c[1]&&(l.debounce=c[1]);return l}(e)}e.selector=function(e,i,s){return t=i||n,r=s||o,l(e.trim()).map(f)},Object.defineProperty(e,"__esModule",{value:!0})}));