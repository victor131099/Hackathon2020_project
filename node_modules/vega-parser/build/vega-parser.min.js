!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-functions"),require("vega-event-selector"),require("vega-scale"),require("vega-dataflow")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-functions","vega-event-selector","vega-scale","vega-dataflow"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).vega={},e.vega,e.vega,e.vega,e.vega,e.vega)}(this,(function(e,t,i,n,a,r){"use strict";function l(e){return t.isObject(e)?e:{type:e||"pad"}}const s=e=>+e||0;function o(e){return t.isObject(e)?e.signal?e:{top:s(e.top),bottom:s(e.bottom),left:s(e.left),right:s(e.right)}:{top:i=s(e),bottom:i,left:i,right:i};var i}const u=e=>t.isObject(e)&&!t.isArray(e)?t.extend({},e):{value:e};function d(e,i,n,a){if(null!=n){return t.isObject(n)&&!t.isArray(n)||t.isArray(n)&&n.length&&t.isObject(n[0])?e.update[i]=n:e[a||"enter"][i]={value:n},1}return 0}function c(e,t,i){for(const i in t)d(e,i,t[i]);for(const t in i)d(e,t,i[t],"update")}function f(e,i,n){for(const a in i)n&&t.hasOwnProperty(n,a)||(e[a]=t.extend(e[a]||{},i[a]));return e}function p(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function g(e,t,i){e[t]=i&&i.signal?{signal:i.signal}:{value:i}}const m=e=>t.isString(e)?t.stringValue(e):e.signal?`(${e.signal})`:x(e);function h(e){if(null!=e.gradient)return function(e){const i=[e.start,e.stop,e.count].map(e=>null==e?null:t.stringValue(e));for(;i.length&&null==t.peek(i);)i.pop();return i.unshift(m(e.gradient)),`gradient(${i.join(",")})`}(e);let i=e.signal?`(${e.signal})`:e.color?function(e){return e.c?y("hcl",e.h,e.c,e.l):e.h||e.s?y("hsl",e.h,e.s,e.l):e.l||e.a?y("lab",e.l,e.a,e.b):e.r||e.g||e.b?y("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?x(e.field):void 0!==e.value?t.stringValue(e.value):void 0;return null!=e.scale&&(i=function(e,t){const i=m(e.scale);null!=e.range?t=`lerp(_range(${i}), ${+e.range})`:(void 0!==t&&(t=`_scale(${i}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${i})`+(1==+e.band?"":"*"+b(e.band)),e.extra&&(t=`(datum.extra ? _scale(${i}, datum.extra.value) : ${t})`)),null==t&&(t="0"));return t}(e,i)),void 0===i&&(i=null),null!=e.exponent&&(i=`pow(${i},${b(e.exponent)})`),null!=e.mult&&(i+="*"+b(e.mult)),null!=e.offset&&(i+="+"+b(e.offset)),e.round&&(i=`round(${i})`),i}const y=(e,t,i,n)=>`(${e}(${[t,i,n].map(h).join(",")})+'')`;function b(e){return t.isObject(e)?"("+h(e)+")":e}function x(e){return function e(i){let n,a,r;if(i.signal)n="datum",r=i.signal;else if(i.group||i.parent){for(a=Math.max(1,i.level||1),n="item";a-- >0;)n+=".mark.group";i.parent?(r=i.parent,n+=".datum"):r=i.group}else i.datum?(n="datum",r=i.datum):t.error("Invalid field reference: "+t.stringValue(i));i.signal||(r=t.isString(r)?t.splitAccessPath(r).map(t.stringValue).join("]["):e(r));return n+"["+r+"]"}(t.isObject(e)?e:{datum:e})}function k(e,i,n,a,r,l){const s={};(l=l||{}).encoders={$encode:s},e=function(e,i,n,a,r){const l={},s={};let o,u,d,c;for(u in u="lineBreak","text"!==i||null==r[u]||p(u,e)||g(l,u,r[u]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c="frame"===n?r.group:"mark"===n?t.extend({},r.mark,r[i]):null,c)d=p(u,e)||("fill"===u||"stroke"===u)&&(p("fill",e)||p("stroke",e)),d||g(l,u,c[u]);for(u in t.array(a).forEach(t=>{const i=r.style&&r.style[t];for(const t in i)p(t,e)||g(l,t,i[t])}),e=t.extend({},e),l)c=l[u],c.signal?(o=o||{})[u]=c:s[u]=c;return e.enter=t.extend(s,e.enter),o&&(e.update=t.extend(o,e.update)),e}(e,i,n,a,r.config);for(const t in e)s[t]=v(e[t],i,l,r);return l}function v(e,i,n,a){const r={},l={};for(const i in e)null!=e[i]&&(r[i]=$((s=e[i],t.isArray(s)?function(e){let i="";return e.forEach(e=>{const t=h(e);i+=e.test?`(${e.test})?${t}:`:t}),":"===t.peek(i)&&(i+="null"),i}(s):h(s)),a,n,l));var s;return{$expr:{marktype:i,channels:r},$fields:Object.keys(l),$output:Object.keys(e)}}function $(e,n,a,r){const l=i.parseExpression(e,n);return l.$fields.forEach(e=>r[e]=1),t.extend(a,l.$params),l.$expr}const S=["value","update","init","react","bind"];function O(e,i){t.error(e+' for "outer" push: '+t.stringValue(i))}function R(e,t){const i=e.name;if("outer"===e.push)t.signals[i]||O("No prior signal definition",i),S.forEach(t=>{void 0!==e[t]&&O("Invalid property ",t)});else{const n=t.addSignal(i,e.value);!1===e.react&&(n.react=!1),e.bind&&t.addBinding(i,e.bind)}}function z(e,t,i,n){this.id=-1,this.type=e,this.value=t,this.params=i,n&&(this.parent=n)}function j(e,t,i,n){return new z(e,t,i,n)}function w(e,t){return j("operator",e,t)}function W(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function P(e,t){return t?{$field:e,$name:t}:{$field:e}}const D=P("key");function V(e,t){return{$compare:e,$order:t}}function C(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function E(e){return e&&e.signal}function _(e){if(E(e))return!0;if(t.isObject(e))for(const t in e)if(_(e[t]))return!0;return!1}function L(e,t){return null!=e?e:t}function F(e){return e&&e.signal||e}function A(e,i){return(e.merge?T:e.stream?B:e.type?q:t.error("Invalid stream specification: "+t.stringValue(e)))(e,i)}function T(e,t){const i=U({merge:e.merge.map(e=>A(e,t))},e,t);return t.addStream(i).id}function B(e,t){const i=U({stream:A(e.stream,t)},e,t);return t.addStream(i).id}function q(e,t){let i,n;var a;return"timer"===e.type?(i=t.event("timer",e.throttle),e={between:e.between,filter:e.filter}):i=t.event("scope"===(a=e.source)?"view":a||"view",e.type),n=U({stream:i},e,t),1===Object.keys(n).length?i:t.addStream(n).id}function U(e,n,a){let r=n.between;return r&&(2!==r.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[A(r[0],a),A(r[1],a)]),r=n.filter?[].concat(n.filter):[],(n.marktype||n.markname||n.markrole)&&r.push(function(e,t,i){const n="event.item";return n+(e&&"*"!==e?"&&"+n+".mark.marktype==='"+e+"'":"")+(i?"&&"+n+".mark.role==='"+i+"'":"")+(t?"&&"+n+".mark.name==='"+t+"'":"")}(n.marktype,n.markname,n.markrole)),"scope"===n.source&&r.push("inScope(event.item)"),r.length&&(e.filter=i.parseExpression("("+r.join(")&&(")+")",a).$expr),null!=(r=n.throttle)&&(e.throttle=+r),null!=(r=n.debounce)&&(e.debounce=+r),n.consume&&(e.consume=!0),e}const M={code:"_.$value",ast:{type:"Identifier",value:"value"}};function H(e,a,r){let l=e.events,s=e.update,o=e.encode,u=[],d={target:r};l||t.error("Signal update missing events specification."),t.isString(l)&&(l=n.selector(l,a.isSubscope()?"scope":"view")),l=t.array(l).filter(e=>e.signal||e.scale?(u.push(e),0):1),u.length>1&&(u=[I(u)]),l.length&&u.push(l.length>1?{merge:l}:l[0]),null!=o&&(s&&t.error("Signal encode and update are mutually exclusive."),s="encode(item(),"+t.stringValue(o)+")"),d.update=t.isString(s)?i.parseExpression(s,a):null!=s.expr?i.parseExpression(s.expr,a):null!=s.value?s.value:null!=s.signal?{$expr:M,$params:{$value:a.signalRef(s.signal)}}:t.error("Invalid signal update specification."),e.force&&(d.options={force:!0}),u.forEach(e=>a.addUpdate(t.extend(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):A(e,t)}}(e,a),d)))}function I(e){return{signal:"["+e.map(e=>e.scale?'scale("'+e.scale+'")':e.signal)+"]"}}function X(e,n){let a=n.getSignal(e.name),r=e.update;e.init&&(r?t.error("Signals can not include both init and update expressions."):(r=e.init,a.initonly=!0)),r&&(r=i.parseExpression(r,n),a.update=r.$expr,a.params=r.$params),e.on&&e.on.forEach(e=>H(e,n,a.id))}const Y=e=>(t,i,n)=>j(e,i,t||void 0,n),N=Y("aggregate"),G=Y("axisticks"),Q=Y("bound"),J=Y("collect"),K=Y("compare"),Z=Y("datajoin"),ee=Y("encode"),te=Y("expression"),ie=Y("facet"),ne=Y("field"),ae=Y("key"),re=Y("legendentries"),le=Y("load"),se=Y("mark"),oe=Y("multiextent"),ue=Y("multivalues"),de=Y("overlap"),ce=Y("params"),fe=Y("prefacet"),pe=Y("projection"),ge=Y("proxy"),me=Y("relay"),he=Y("render"),ye=Y("scale"),be=Y("sieve"),xe=Y("sortitems"),ke=Y("viewlayout"),ve=Y("values");let $e=0;const Se={min:"min",max:"max",count:"sum"};function Oe(e,i){let n,r=i.getScale(e.name).params;var l;for(n in r.domain=we(e.domain,e,i),null!=e.range&&(r.range=function e(i,n,r){let l=i.range,s=n.config.range;if(l.signal)return n.signalRef(l.signal);if(t.isString(l)){if(s&&t.hasOwnProperty(s,l))return e(i=t.extend({},i,{range:s[l]}),n,r);"width"===l?l=[0,{signal:"width"}]:"height"===l?l=a.isDiscrete(i.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(l))}else{if(l.scheme)return r.scheme=t.isArray(l.scheme)?ze(l.scheme,n):Re(l.scheme,n),l.extent&&(r.schemeExtent=ze(l.extent,n)),void(l.count&&(r.schemeCount=Re(l.count,n)));if(l.step)return void(r.rangeStep=Re(l.step,n));if(a.isDiscrete(i.type)&&!t.isArray(l))return we(l,i,n);t.isArray(l)||t.error("Unsupported range type: "+t.stringValue(l))}return l.map(e=>(t.isArray(e)?ze:Re)(e,n))}(e,i,r)),null!=e.interpolate&&function(e,t){t.interpolate=Re(e.type||e),null!=e.gamma&&(t.interpolateGamma=Re(e.gamma))}(e.interpolate,r),null!=e.nice&&(r.nice=(l=e.nice,t.isObject(l)?{interval:Re(l.interval),step:Re(l.step)}:Re(l))),null!=e.bins&&(r.bins=function(e,i){return e.signal||t.isArray(e)?ze(e,i):i.objectProperty(e)}(e.bins,i)),e)t.hasOwnProperty(r,n)||"name"===n||(r[n]=Re(e[n],i))}function Re(e,i){return t.isObject(e)?e.signal?i.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function ze(e,t){return e.signal?t.signalRef(e.signal):e.map(e=>Re(e,t))}function je(e){t.error("Can not find data set: "+t.stringValue(e))}function we(e,i,n){if(e)return e.signal?n.signalRef(e.signal):(t.isArray(e)?We:e.fields?De:Pe)(e,i,n);null==i.domainMin&&null==i.domainMax||t.error("No scale domain defined for domainMin/domainMax to override.")}function We(e,t,i){return e.map(e=>Re(e,i))}function Pe(e,t,i){const n=i.getData(e.data);return n||je(e.data),a.isDiscrete(t.type)?n.valuesRef(i,e.field,Ce(e.sort,!1)):a.isQuantile(t.type)?n.domainRef(i,e.field):n.extentRef(i,e.field)}function De(e,i,n){const r=e.data,l=e.fields.reduce((function(e,i){return i=t.isString(i)?{data:r,field:i}:t.isArray(i)||i.signal?function(e,i){const n="_:vega:_"+$e++,a=J({});if(t.isArray(e))a.value={$ingest:e};else if(e.signal){const r="setdata("+t.stringValue(n)+","+e.signal+")";a.params.input=i.signalRef(r)}return i.addDataPipeline(n,[a,be({})]),{data:n,field:"data"}}(i,n):i,e.push(i),e}),[]);return(a.isDiscrete(i.type)?Ve:a.isQuantile(i.type)?Ee:_e)(e,n,l)}function Ve(e,t,i){let n,a,r,l,s,o=Ce(e.sort,!0);return n=i.map(e=>{const i=t.getData(e.data);return i||je(e.data),i.countsRef(t,e.field,o)}),a={groupby:D,pulse:n},o&&(r=o.op||"count",s=o.field?C(r,o.field):"count",a.ops=[Se[r]],a.fields=[t.fieldRef(s)],a.as=[s]),r=t.add(N(a)),l=t.add(J({pulse:W(r)})),s=t.add(ve({field:D,sort:t.sortRef(o),pulse:W(l)})),W(s)}function Ce(e,i){return e&&(e.field||e.op?e.field||"count"===e.op?i&&e.field&&e.op&&!Se[e.op]&&t.error("Multiple domain scales can not be sorted using "+e.op):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function Ee(e,t,i){const n=i.map(e=>{const i=t.getData(e.data);return i||je(e.data),i.domainRef(t,e.field)});return W(t.add(ue({values:n})))}function _e(e,t,i){const n=i.map(e=>{const i=t.getData(e.data);return i||je(e.data),i.extentRef(t,e.field)});return W(t.add(oe({extents:n})))}function Le(e,i,n){return t.isArray(e)?e.map(e=>Le(e,i,n)):t.isObject(e)?e.signal?n.signalRef(e.signal):"fit"===i?e:t.error("Unsupported parameter object: "+t.stringValue(e)):e}const Fe="top",Ae="value",Te=["size","shape","fill","stroke","strokeWidth","strokeDash","opacity"],Be={name:1,style:1,interactive:1},qe={value:0},Ue={value:1};function Me(e){return e.type="group",e.interactive=e.interactive||!1,e}function He(e,t){const i=(i,n)=>L(e[i],L(t[i],n));return i.isVertical=i=>"vertical"===L(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),i.gradientLength=()=>L(e.gradientLength,t.gradientLength||t.gradientWidth),i.gradientThickness=()=>L(e.gradientThickness,t.gradientThickness||t.gradientHeight),i.entryColumns=()=>L(e.columns,L(t.columns,+i.isVertical(!0))),i}function Ie(e,t){const i=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return i&&i.signal?i:i?i.value:null}function Xe(e,t,i){return`item.anchor === 'start' ? ${e} : item.anchor === 'end' ? ${t} : ${i}`}const Ye=Xe(t.stringValue("left"),t.stringValue("right"),t.stringValue("center"));function Ne(e,i){return i?e?t.isObject(e)?Object.assign({},e,{offset:Ne(e.offset,i)}):{value:e,offset:i}:i:e}function Ge(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=f(e.encode,t,Be)):e.interactive=!1,e}function Qe(e,i,n,a){let r,l,s,o,d,f,p=He(e,n),g=p.isVertical(),m=p.gradientThickness(),h=p.gradientLength();return g?(s=[0,1],o=[0,0],d=m,f=h):(s=[0,0],o=[1,0],d=h,f=m),r={enter:l={opacity:qe,x:qe,y:qe,width:u(d),height:u(f)},update:t.extend({},l,{opacity:Ue,fill:{gradient:i,start:s,stop:o}}),exit:{opacity:qe}},c(r,{stroke:p("gradientStrokeColor"),strokeWidth:p("gradientStrokeWidth")},{opacity:p("gradientOpacity")}),Ge({type:"rect",role:"legend-gradient",encode:r},a)}function Je(e,i,n,a,r){let l,s,o,d,f,p,g=He(e,n),m=g.isVertical(),h=g.gradientThickness(),y=g.gradientLength(),b="";return m?(o="y",f="y2",d="x",p="width",b="1-"):(o="x",f="x2",d="y",p="height"),s={opacity:qe,fill:{scale:i,field:Ae}},s[o]={signal:b+"datum.perc",mult:y},s[d]=qe,s[f]={signal:b+"datum.perc2",mult:y},s[p]=u(h),l={enter:s,update:t.extend({},s,{opacity:Ue}),exit:{opacity:qe}},c(l,{stroke:g("gradientStrokeColor"),strokeWidth:g("gradientStrokeWidth")},{opacity:g("gradientOpacity")}),Ge({type:"rect",role:"legend-band",key:Ae,from:r,encode:l},a)}function Ke(e,t,i,n){let a,r,l,s,o,d=He(e,t),f=d.isVertical(),p=u(d.gradientThickness()),g=d.gradientLength(),m=d("labelOverlap"),h="";return a={enter:r={opacity:qe},update:l={opacity:Ue,text:{field:"label"}},exit:{opacity:qe}},c(a,{fill:d("labelColor"),fillOpacity:d("labelOpacity"),font:d("labelFont"),fontSize:d("labelFontSize"),fontStyle:d("labelFontStyle"),fontWeight:d("labelFontWeight"),limit:L(e.labelLimit,t.gradientLabelLimit)}),f?(r.align={value:"left"},r.baseline=l.baseline={signal:'datum.perc<=0?"bottom":datum.perc>=1?"top":"middle"'},s="y",o="x",h="1-"):(r.align=l.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},r.baseline={value:"top"},s="x",o="y"),r[s]=l[s]={signal:h+"datum.perc",mult:g},r[o]=l[o]=p,p.offset=L(e.labelOffset,t.gradientLabelOffset)||0,m=m?{separation:d("labelSeparation"),method:m,order:"datum.index"}:void 0,Ge({type:"text",role:"legend-label",style:"guide-label",key:Ae,from:n,encode:a,overlap:m},i)}function Ze(e,t,i,n,a){let r,l,s,o,d,p,g,m=He(e,t),h=i.entries,y=!(!h||!h.interactive),b=h?h.name:void 0,x=m("clipHeight"),k=m("symbolOffset"),v={data:"value"},$={},S=`(${a}) ? datum.offset : datum.size`,O=x?u(x):{field:"size"},R="datum.index",z=`max(1, ${a})`;O.mult=.5,$={enter:r={opacity:qe,x:{signal:S,mult:.5,offset:k},y:O},update:l={opacity:Ue,x:r.x,y:r.y},exit:{opacity:qe}};let j=null,w=null;return e.fill||(j=t.symbolBaseFillColor,w=t.symbolBaseStrokeColor),c($,{fill:m("symbolFillColor",j),shape:m("symbolType"),size:m("symbolSize"),stroke:m("symbolStrokeColor",w),strokeDash:m("symbolDash"),strokeDashOffset:m("symbolDashOffset"),strokeWidth:m("symbolStrokeWidth")},{opacity:m("symbolOpacity")}),Te.forEach((function(t){e[t]&&(l[t]=r[t]={scale:e[t],field:Ae})})),o=Ge({type:"symbol",role:"legend-symbol",key:Ae,from:v,clip:!!x||void 0,encode:$},i.symbols),s=u(k),s.offset=m("labelOffset"),$={enter:r={opacity:qe,x:{signal:S,offset:s},y:O},update:l={opacity:Ue,text:{field:"label"},x:r.x,y:r.y},exit:{opacity:qe}},c($,{align:m("labelAlign"),baseline:m("labelBaseline"),fill:m("labelColor"),fillOpacity:m("labelOpacity"),font:m("labelFont"),fontSize:m("labelFontSize"),fontStyle:m("labelFontStyle"),fontWeight:m("labelFontWeight"),limit:m("labelLimit")}),d=Ge({type:"text",role:"legend-label",style:"guide-label",key:Ae,from:v,encode:$},i.labels),$={enter:{noBound:{value:!x},width:qe,height:x?u(x):qe,opacity:qe},exit:{opacity:qe},update:l={opacity:Ue,row:{signal:null},column:{signal:null}}},m.isVertical(!0)?(p=`ceil(item.mark.items.length / ${z})`,l.row.signal=`${R}%${p}`,l.column.signal=`floor(${R} / ${p})`,g={field:["row",R]}):(l.row.signal=`floor(${R} / ${z})`,l.column.signal=`${R} % ${z}`,g={field:R}),l.column.signal=`(${a})?${l.column.signal}:${R}`,Me({role:"scope",from:n={facet:{data:n,name:"value",groupby:"index"}},encode:f($,h,Be),marks:[o,d],name:b,interactive:y,sort:g})}const et='item.orient === "left"',tt='item.orient === "right"',it=`(${et} || ${tt})`,nt="datum.vgrad && "+it,at=Xe('"top"','"bottom"','"middle"'),rt=`datum.vgrad && ${tt} ? (${Xe('"right"','"left"','"center"')}) : (${it} && !(datum.vgrad && ${et})) ? "left" : ${Ye}`,lt=`item._anchor || (${it} ? "middle" : "start")`,st=`${nt} ? (${et} ? -90 : 90) : 0`,ot=`${it} ? (datum.vgrad ? (${tt} ? "bottom" : "top") : ${at}) : "top"`;function ut(e,i){let n;return t.isObject(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+dt(e.path)+")":e.sphere&&(n="geoShape("+dt(e.sphere)+', {type: "Sphere"})')),n?i.signalRef(n):!!e}function dt(e){return t.isObject(e)&&e.signal?e.signal:t.stringValue(e)}function ct(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?"group"===e.type?"scope":t||"mark":t}function ft(e){return{marktype:e.type,name:e.name||void 0,role:e.role||ct(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function pt(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function gt(e,i){const n=r.definition(e.type);n||t.error("Unrecognized transform type: "+t.stringValue(e.type));const a=j(n.type.toLowerCase(),null,mt(n,e,i));return e.signal&&i.addSignal(e.signal,i.proxy(a)),a.metadata=n.metadata||{},a}function mt(e,t,i){let n,a,r,l={};for(a=0,r=e.params.length;a<r;++a)n=e.params[a],l[n.name]=ht(n,t,i);return l}function ht(e,i,n){const a=e.type,r=i[e.name];return"index"===a?function(e,i,n){t.isString(i.from)||t.error('Lookup "from" parameter must be a string literal.');return n.getData(i.from).lookupRef(n,i.key)}(0,i,n):void 0!==r?"param"===a?function(e,i,n){const a=i[e.name];return e.array?(t.isArray(a)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(a)),a.map(t=>bt(e,t,n))):bt(e,a,n)}(e,i,n):"projection"===a?n.projectionRef(i[e.name]):e.array&&!E(r)?r.map(t=>yt(e,t,n)):yt(e,r,n):void(e.required&&t.error("Missing required "+t.stringValue(i.type)+" parameter: "+t.stringValue(e.name)))}function yt(e,n,a){const r=e.type;if(E(n))return $t(r)?t.error("Expression references can not be signals."):St(r)?a.fieldRef(n):Ot(r)?a.compareRef(n):a.signalRef(n.signal);{const t=e.expr||St(r);return t&&xt(n)?a.exprRef(n.expr,n.as):t&&kt(n)?P(n.field,n.as):$t(r)?i.parseExpression(n,a):vt(r)?W(a.getData(n).values):St(r)?P(n):Ot(r)?a.compareRef(n):n}}function bt(e,i,n){let a,r,l,s,o;for(s=0,o=e.params.length;s<o;++s){for(l in r=e.params[s],r.key)if(r.key[l]!==i[l]){r=null;break}if(r)break}return r||t.error("Unsupported parameter: "+t.stringValue(i)),a=t.extend(mt(r,i,n),r.key),W(n.add(ce(a)))}const xt=e=>e&&e.expr,kt=e=>e&&e.field,vt=e=>"data"===e,$t=e=>"expr"===e,St=e=>"field"===e,Ot=e=>"compare"===e;function Rt(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:W(t.getData(e.data).output)}function zt(e,t,i,n,a){this.scope=e,this.input=t,this.output=i,this.values=n,this.aggregate=a,this.index={}}function jt(e){return t.isString(e)?e:null}function wt(e,t,i){let n,a=C(i.op,i.field);if(t.ops){for(let e=0,i=t.as.length;e<i;++e)if(t.as[e]===a)return}else t.ops=["count"],t.fields=[null],t.as=["count"];i.op&&(t.ops.push((n=i.op.signal)?e.signalRef(n):i.op),t.fields.push(e.fieldRef(i.field)),t.as.push(a))}function Wt(e,i,n,a,r,l,s){let o,u,d=i[n]||(i[n]={}),c=function(e){return t.isObject(e)?("descending"===e.order?"-":"+")+C(e.op,e.field):""}(l),f=jt(r);if(null!=f&&(e=i.scope,f+=c?"|"+c:"",o=d[f]),!o){const t=l?{field:D,pulse:i.countsRef(e,r,l)}:{field:e.fieldRef(r),pulse:W(i.output)};c&&(t.sort=e.sortRef(l)),u=e.add(j(a,void 0,t)),s&&(i.index[r]=u),o=W(u),null!=f&&(d[f]=o)}return o}function Pt(e,t,n){let a,r,l=e.remove,s=e.insert,o=e.toggle,u=e.modify,d=e.values,c=t.add(w());a="if("+e.trigger+',modify("'+n+'",'+[s,l,o,u,d].map(e=>null==e?"null":e).join(",")+"),0)",r=i.parseExpression(a,t),c.update=r.$expr,c.params=r.$params}function Dt(e,i){let n,a,r,l,s,o,u,d,c,f,p,g,m,h,y=ct(e),b="group"===e.type,x=e.from&&e.from.facet,v=e.layout||"scope"===y||"frame"===y,$="mark"===y||v||x,S=e.overlap;r=function(e,i,n){let a,r,l,s,o;return e?(a=e.facet)&&(i||t.error("Only group marks can be faceted."),null!=a.field?s=o=Rt(a,n):(e.data?o=W(n.getData(e.data).aggregate):(l=gt(t.extend({type:"aggregate",groupby:t.array(a.groupby)},a.aggregate),n),l.params.key=n.keyRef(a.groupby),l.params.pulse=Rt(a,n),s=o=W(n.add(l))),r=n.keyRef(a.groupby,!0))):s=W(n.add(J(null,[{}]))),s||(s=Rt(e,n)),{key:r,pulse:s,parent:o}}(e.from,b,i),a=i.add(Z({key:r.key||(e.key?P(e.key):void 0),pulse:r.pulse,clean:!b})),f=W(a),a=l=i.add(J({pulse:f})),a=i.add(se({markdef:ft(e),interactive:pt(e.interactive,i),clip:ut(e.clip,i),context:{$context:!0},groups:i.lookup(),parent:i.signals.parent?i.signalRef("parent"):null,index:i.markpath(),pulse:W(a)})),p=W(a),a=s=i.add(ee(k(e.encode,e.type,y,e.style,i,{mod:!1,pulse:p}))),a.params.parent=i.encode(),e.transform&&e.transform.forEach(e=>{const n=gt(e,i),r=n.metadata;(r.generates||r.changes)&&t.error("Mark transforms should not generate new data."),r.nomod||(s.params.mod=!0),n.params.pulse=W(a),i.add(a=n)}),e.sort&&(a=i.add(xe({sort:i.compareRef(e.sort),pulse:W(a)}))),g=W(a),(x||v)&&(v=i.add(ke({layout:i.objectProperty(e.layout),legends:i.legends,mark:p,pulse:g})),m=W(v)),o=i.add(Q({mark:p,pulse:m||g})),h=W(o),b&&($&&(n=i.operators,n.pop(),v&&n.pop()),i.pushState(g,m||h,f),x?function(e,i,n){let a,r,l,s,o=e.from.facet,u=o.name,d=Rt(o,i);o.name||t.error("Facet must have a name: "+t.stringValue(o)),o.data||t.error("Facet must reference a data set: "+t.stringValue(o)),o.field?s=i.add(fe({field:i.fieldRef(o.field),pulse:d})):o.groupby?s=i.add(ie({key:i.keyRef(o.groupby),group:W(i.proxy(n.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(o)),a=i.fork(),r=a.add(J()),l=a.add(be({pulse:W(r)})),a.addData(u,new zt(a,r,r,l)),a.addSignal("parent",null),s.params.subflow={$subflow:a.parse(e).toRuntime()}}(e,i,r):$?function(e,t,i){const n=t.add(fe({pulse:i.pulse})),a=t.fork();a.add(be()),a.addSignal("parent",null),n.params.subflow={$subflow:a.parse(e).toRuntime()}}(e,i,r):i.parse(e),i.popState(),$&&(v&&n.push(v),n.push(o))),S&&(h=function(e,t,i){const n=e.method,a=e.bound,r=e.separation,l={separation:E(r)?i.signalRef(r.signal):r,method:E(n)?i.signalRef(n.signal):n,pulse:t};e.order&&(l.sort=i.compareRef({field:e.order}));if(a){const e=a.tolerance;l.boundTolerance=E(e)?i.signalRef(e.signal):+e,l.boundScale=i.scaleRef(a.scale),l.boundOrient=a.orient}return W(i.add(de(l)))}(S,h,i)),u=i.add(he({pulse:h})),d=i.add(be({pulse:W(u)},void 0,i.parent())),null!=e.name&&(c=e.name,i.addData(c,new zt(i,l,u,d)),e.on&&e.on.forEach(e=>{(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),Pt(e,i,c)}))}function Vt(e,n){let r,l,s,o,u,d,p,g,m=n.config.legend,h=e.encode||{},y=h.legend||{},b=y.name||void 0,x=y.interactive,k=y.style,v=He(e,m),$={},S=0;return Te.forEach(t=>e[t]?($[t]=e[t],S=S||e[t]):0),S||t.error("Missing valid scale for legend."),u=function(e,t){let i=e.type||"symbol";e.type||1!==function(e){return Te.reduce((function(t,i){return t+(e[i]?1:0)}),0)}(e)||!e.fill&&!e.stroke||(i=a.isContinuous(t)?"gradient":a.isDiscretizing(t)?"discrete":"symbol");return"gradient"!==i?i:a.isDiscretizing(t)?"discrete":"gradient"}(e,n.scaleType(S)),d={title:null!=e.title,scales:$,type:u,vgrad:"symbol"!==u&&v.isVertical()},p=W(n.add(J(null,[d]))),y=f(function(e,t,i){const n={enter:{},update:{}};return c(n,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:i.strokeWidth,strokeDash:i.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),n}(v,e,m),y,Be),r={enter:{x:{value:0},y:{value:0}}},g=W(n.add(re(s={type:u,scale:n.scaleRef(S),count:n.objectProperty(v("tickCount")),limit:n.property(v("symbolLimit")),values:n.objectProperty(e.values),minstep:n.property(e.tickMinStep),formatType:n.property(e.formatType),formatSpecifier:n.property(e.format)}))),"gradient"===u?(o=[Qe(e,S,m,h.gradient),Ke(e,m,h.labels,g)],s.count=s.count||n.signalRef(`max(2,2*floor((${F(v.gradientLength())})/100))`)):"discrete"===u?o=[Je(e,S,m,h.gradient,g),Ke(e,m,h.labels,g)]:(l=function(e,t){const i=He(e,t);return{align:i("gridAlign"),columns:i.entryColumns(),center:{row:!0,column:!1},padding:{row:i("rowPadding"),column:i("columnPadding")}}}(e,m),o=[Ze(e,m,h,g,F(l.columns))],s.size=function(e,t,n){const a=F(Ct("size",e,n)),r=F(Ct("strokeWidth",e,n)),l=F(function(e,t,i){return Ie("fontSize",e)||function(e,t,i){const n=t.config.style[i];return n&&n[e]}("fontSize",t,i)}(n[1].encode,t,"guide-label"));return i.parseExpression(`max(ceil(sqrt(${a})+${r}),${l})`,t)}(e,n,o[0].marks)),o=[Me({role:"legend-entry",from:p,encode:r,marks:o,layout:l,interactive:x})],d.title&&o.push(function(e,t,i,n){let a,r=He(e,t);return a={enter:{opacity:qe},update:{opacity:Ue,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:qe}},c(a,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:lt},angle:{signal:st},align:{signal:rt},baseline:{signal:ot},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),Ge({type:"text",role:"legend-title",style:"guide-title",from:n,encode:a},i)}(e,m,h.title,p)),Dt(Me({role:"legend",from:p,encode:y,marks:o,aria:v("aria"),description:v("description"),zindex:v("zindex"),name:b,interactive:x,style:k}),n)}function Ct(e,t,i){return t[e]?`scale("${t[e]}",datum)`:Ie(e,i[0].encode)}zt.fromEntries=function(e,t){let i=t.length,n=1,a=t[0],r=t[i-1],l=t[i-2],s=null;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);n<i;++n)t[n].params.pulse=W(t[n-1]),e.add(t[n]),"aggregate"===t[n].type&&(s=t[n]);return new zt(e,a,l,r,s)},zt.prototype={countsRef(e,t,i){let n,a,r,l=this,s=l.counts||(l.counts={}),o=jt(t);return null!=o&&(e=l.scope,n=s[o]),n?i&&i.field&&wt(e,n.agg.params,i):(r={groupby:e.fieldRef(t,"key"),pulse:W(l.output)},i&&i.field&&wt(e,r,i),a=e.add(N(r)),n=e.add(J({pulse:W(a)})),n={agg:a,ref:W(n)},null!=o&&(s[o]=n)),n.ref},tuplesRef(){return W(this.values)},extentRef(e,t){return Wt(e,this,"extent","extent",t,!1)},domainRef(e,t){return Wt(e,this,"domain","values",t,!1)},valuesRef(e,t,i){return Wt(e,this,"vals","values",t,i||!0)},lookupRef(e,t){return Wt(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return Wt(e,this,"indata","tupleindex",t,!0,!0)}};function Et(e,i){let n,a,r=He(e=t.isString(e)?{text:e}:e,i.config.title),l=e.encode||{},s=l.group||{},o=s.name||void 0,u=s.interactive,d=s.style,f=[];return n={},a=W(i.add(J(null,[n]))),f.push(function(e,t,i,n){const a={value:0},r=e.text,l={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return c(l,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Ge({type:"text",role:"title-text",style:"group-title",from:n,encode:l},i)}(e,r,function(e){const i=e.encode;return i&&i.title||t.extend({name:e.name,interactive:e.interactive,style:e.style},i)}(e),a)),e.subtitle&&f.push(function(e,t,i,n){const a={value:0},r=e.subtitle,l={enter:{opacity:a},update:{opacity:{value:1}},exit:{opacity:a}};return c(l,{text:r,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),Ge({type:"text",role:"title-subtitle",style:"group-subtitle",from:n,encode:l},i)}(e,r,l.subtitle,a)),Dt(Me({role:"title",from:a,encode:_t(r,s),marks:f,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:u,style:d}),i)}function _t(e,t){const i={enter:{},update:{}};return c(i,{orient:e("orient"),anchor:e("anchor"),align:{signal:Ye},angle:{signal:'item.orient==="left"?-90:item.orient==="right"?90:0'},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),f(i,t,Be)}function Lt(e,i){const n=[];e.transform&&e.transform.forEach(e=>{n.push(gt(e,i))}),e.on&&e.on.forEach((function(t){Pt(t,i,e.name)})),i.addDataPipeline(e.name,function(e,i,n){let a,r,l,s,o,u=[],d=null,c=!1,f=!1;e.values?_(e.values)||_(e.format)?(u.push(At(i,e)),u.push(d=Ft())):u.push(d=Ft({$ingest:e.values,$format:e.format})):e.url?_(e.url)||_(e.format)?(u.push(At(i,e)),u.push(d=Ft())):u.push(d=Ft({$request:e.url,$format:e.format})):e.source&&(d=a=t.array(e.source).map(e=>W(i.getData(e).output)),u.push(null));for(r=0,l=n.length;r<l;++r)s=n[r],o=s.metadata,d||o.source||u.push(d=Ft()),u.push(s),o.generates&&(f=!0),o.modifies&&!f&&(c=!0),o.source?d=s:o.changes&&(d=null);a&&(l=a.length-1,u[0]=me({derive:c,pulse:l?a:a[0]}),(c||l)&&u.splice(1,0,Ft()));d||u.push(Ft());return u.push(be({})),u}(e,i,n))}function Ft(e){const t=J({},e);return t.metadata={source:!0},t}function At(e,t){return le({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const Tt=e=>"bottom"===e||e===Fe,Bt=(e,t,i)=>E(e)?Xt(e.signal,t,i):"left"===e||e===Fe?t:i,qt=(e,t,i)=>E(e)?Ht(e.signal,t,i):Tt(e)?t:i,Ut=(e,t,i)=>E(e)?It(e.signal,t,i):Tt(e)?i:t,Mt=(e,t,i)=>E(e)?Yt(e.signal,t,i):e===Fe?{value:t}:{value:i},Ht=(e,t,i)=>Gt(`${e} === 'top' || ${e} === 'bottom'`,t,i),It=(e,t,i)=>Gt(`${e} !== 'top' && ${e} !== 'bottom'`,t,i),Xt=(e,t,i)=>Jt(`${e} === 'left' || ${e} === 'top'`,t,i),Yt=(e,t,i)=>Jt(e+" === 'top'",t,i),Nt=(e,t,i)=>Jt(e+" === 'right'",t,i),Gt=(e,i,n)=>(i=null!=i?u(i):i,n=null!=n?u(n):n,Qt(i)&&Qt(n)?{signal:`${e} ? (${i=i?i.signal||t.stringValue(i.value):null}) : (${n=n?n.signal||t.stringValue(n.value):null})`}:[t.extend({test:e},i)].concat(n||[])),Qt=e=>null==e||1===Object.keys(e).length,Jt=(e,t,i)=>({signal:`${e} ? (${Kt(t)}) : (${Kt(i)})`}),Kt=e=>E(e)?e.signal:null==e?null:t.stringValue(e),Zt=(e,t)=>{const i=e.signal;return i&&i.endsWith("(null)")?{signal:i.slice(0,-6)+t.signal}:e};function ei(e,i,n,a){let r;if(i&&t.hasOwnProperty(i,e))return i[e];if(t.hasOwnProperty(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return a["guide-title"][r]}if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return a["guide-label"][r]}return null}function ti(e){const t={};for(const i of e)if(i)for(const e in i)t[e]=1;return Object.keys(t)}function ii(e,t){return{scale:e.scale,range:t}}function ni(e,i,n,a,r){let l,s,o,u,d,f,p,g,m=He(e,i),h=e.orient,y=e.gridScale,b=Bt(h,1,-1),x=function(e,i){if(1===i);else if(t.isObject(e)){let n=e=t.extend({},e);for(;null!=n.mult;){if(!t.isObject(n.mult))return n.mult=E(i)?{signal:`(${n.mult}) * (${i.signal})`}:n.mult*i,e;n=n.mult=t.extend({},n.mult)}n.mult=i}else e=E(i)?{signal:`(${i.signal}) * (${e||0})`}:i*(e||0);return e}(e.offset,b);return l={enter:s={opacity:qe},update:u={opacity:Ue},exit:o={opacity:qe}},c(l,{stroke:m("gridColor"),strokeCap:m("gridCap"),strokeDash:m("gridDash"),strokeDashOffset:m("gridDashOffset"),strokeOpacity:m("gridOpacity"),strokeWidth:m("gridWidth")}),d={scale:e.scale,field:Ae,band:r.band,extra:r.extra,offset:r.offset,round:m("tickRound")},g=qt(h,{signal:"height"},{signal:"width"}),f=y?{scale:y,range:0,mult:b,offset:x}:{value:0,offset:x},p=y?{scale:y,range:1,mult:b,offset:x}:t.extend(g,{mult:b,offset:x}),s.x=u.x=qt(h,d,f),s.y=u.y=Ut(h,d,f),s.x2=u.x2=Ut(h,p),s.y2=u.y2=qt(h,p),o.x=qt(h,d),o.y=Ut(h,d),Ge({type:"rule",role:"axis-grid",key:Ae,from:a,encode:l},n)}function ai(e,t,i,n,a){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+i+","+n+","+a+")"}}function ri(e,t,i,n,a,r){let l,s,o,d,f,p,g,m,h,y,b=He(e,t),x=e.orient,k=e.scale,v=Bt(x,-1,1),$=F(b("labelFlush")),S=F(b("labelFlushOffset")),O=0===$||!!$,R=b("labelAlign"),z=b("labelBaseline");return d=u(a),d.mult=v,d.offset=u(b("labelPadding")||0),d.offset.mult=v,f={scale:k,field:Ae,band:.5,offset:Ne(r.offset,b("labelOffset"))},p=qt(x,O?ai(k,$,'"left"','"right"','"center"'):{value:"center"},((e,t,i)=>E(e)?Nt(e.signal,t,i):"right"===e?{value:t}:{value:i})(x,"left","right")),g=qt(x,Mt(x,"bottom","top"),O?ai(k,$,'"top"','"bottom"','"middle"'):{value:"middle"}),y=ai(k,$,`-(${S})`,S,0),O=O&&S,s={opacity:qe,x:qt(x,f,d),y:Ut(x,f,d)},l={enter:s,update:o={opacity:Ue,text:{field:"label"},x:s.x,y:s.y,align:p,baseline:g},exit:{opacity:qe,x:s.x,y:s.y}},c(l,{dx:!R&&O?qt(x,y):null,dy:!z&&O?Ut(x,y):null}),c(l,{angle:b("labelAngle"),fill:b("labelColor"),fillOpacity:b("labelOpacity"),font:b("labelFont"),fontSize:b("labelFontSize"),fontWeight:b("labelFontWeight"),fontStyle:b("labelFontStyle"),limit:b("labelLimit"),lineHeight:b("labelLineHeight")},{align:R,baseline:z}),m=b("labelBound"),h=b("labelOverlap"),h=h||m?{separation:b("labelSeparation"),method:h,order:"datum.index",bound:m?{scale:k,orient:x,tolerance:m}:null}:void 0,o.align!==p&&(o.align=Zt(o.align,p)),o.baseline!==g&&(o.baseline=Zt(o.baseline,g)),Ge({type:"text",role:"axis-label",style:"guide-label",key:Ae,from:n,encode:l,overlap:h},i)}function li(e,i,n,a){let r,l,s,o,d=He(e,i),f=e.orient,g=Bt(f,-1,1);return r={enter:l={opacity:qe,anchor:u(d("titleAnchor",null)),align:{signal:Ye}},update:s=t.extend({},l,{opacity:Ue,text:u(e.title)}),exit:{opacity:qe}},o={signal:`lerp(range("${e.scale}"), ${Xe(0,1,.5)})`},s.x=qt(f,o),s.y=Ut(f,o),l.angle=qt(f,qe,((e,t)=>0===t?0:E(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t})(g,90)),l.baseline=qt(f,Mt(f,"bottom",Fe),{value:"bottom"}),s.angle=l.angle,s.baseline=l.baseline,c(r,{fill:d("titleColor"),fillOpacity:d("titleOpacity"),font:d("titleFont"),fontSize:d("titleFontSize"),fontStyle:d("titleFontStyle"),fontWeight:d("titleFontWeight"),limit:d("titleLimit"),lineHeight:d("titleLineHeight")},{align:d("titleAlign"),angle:d("titleAngle"),baseline:d("titleBaseline")}),function(e,t,i,n){const a=(e,t)=>null!=e?(i.update[t]=Zt(u(e),i.update[t]),!1):!p(t,n),r=a(e("titleX"),"x"),l=a(e("titleY"),"y");i.enter.auto=l===r?u(l):qt(t,u(l),u(r))}(d,f,r,n),r.update.align=Zt(r.update.align,l.align),r.update.angle=Zt(r.update.angle,l.angle),r.update.baseline=Zt(r.update.baseline,l.baseline),Ge({type:"text",role:"axis-title",style:"guide-title",from:a,encode:r},n)}function si(e,i){let n,a,r,l,s,o=function(e,i){var n,a,r,l,s,o,u,d,c=i.config,f=c.style,p=c.axis,g="band"===i.scaleType(e.scale)&&c.axisBand,m=e.orient;if(E(m)){const e=ti([c.axisX,c.axisY]),t=ti([c.axisTop,c.axisBottom,c.axisLeft,c.axisRight]);for(r of(n={},e))n[r]=qt(m,ei(r,c.axisX,p,f),ei(r,c.axisY,p,f));for(r of(a={},t))a[r]=(l=m.signal,s=ei(r,c.axisTop,p,f),o=ei(r,c.axisBottom,p,f),u=ei(r,c.axisLeft,p,f),d=ei(r,c.axisRight,p,f),{signal:(null!=u?`${l} === 'left' ? (${Kt(u)}) : `:"")+(null!=o?`${l} === 'bottom' ? (${Kt(o)}) : `:"")+(null!=d?`${l} === 'right' ? (${Kt(d)}) : `:"")+(null!=s?`${l} === 'top' ? (${Kt(s)}) : `:"")+"(null)"})}else n=m===Fe||"bottom"===m?c.axisX:c.axisY,a=c["axis"+m[0].toUpperCase()+m.slice(1)];return n||a||g?t.extend({},p,n,a,g):p}(e,i),d=e.encode||{},p=d.axis||{},g=p.name||void 0,m=p.interactive,h=p.style,y=He(e,o),b=function(e){let i,n,a=e("tickBand"),r=e("tickOffset");return a?a.signal?(i={signal:`(${a.signal}) === 'extent' ? 1 : 0.5`},n={signal:`(${a.signal}) === 'extent'`},t.isObject(r)||(r={signal:`(${a.signal}) === 'extent' ? 0 : ${r}`})):"extent"===a?(i=1,n=!0,r=0):(i=.5,n=!1):(i=e("bandPosition"),n=e("tickExtra")),{extra:n,band:i,offset:r}}(y);return n={scale:e.scale,ticks:!!y("ticks"),labels:!!y("labels"),grid:!!y("grid"),domain:!!y("domain"),title:null!=e.title},a=W(i.add(J({},[n]))),p=f(function(e,t){const i={enter:{},update:{}};return c(i,{orient:e("orient"),offset:e("offset")||0,position:L(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),i}(y,e),p,Be),r=W(i.add(G({scale:i.scaleRef(e.scale),extra:i.property(b.extra),count:i.objectProperty(e.tickCount),values:i.objectProperty(e.values),minstep:i.property(e.tickMinStep),formatType:i.property(e.formatType),formatSpecifier:i.property(e.format)}))),s=[],n.grid&&s.push(ni(e,o,d.grid,r,b)),n.ticks&&(l=y("tickSize"),s.push(function(e,t,i,n,a,r){let l,s,o,d,f,p,g=He(e,t),m=e.orient,h=Bt(m,-1,1);return l={enter:s={opacity:qe},update:d={opacity:Ue},exit:o={opacity:qe}},c(l,{stroke:g("tickColor"),strokeCap:g("tickCap"),strokeDash:g("tickDash"),strokeDashOffset:g("tickDashOffset"),strokeOpacity:g("tickOpacity"),strokeWidth:g("tickWidth")}),f=u(a),f.mult=h,p={scale:e.scale,field:Ae,band:r.band,extra:r.extra,offset:r.offset,round:g("tickRound")},d.y=s.y=qt(m,qe,p),d.y2=s.y2=qt(m,f),o.x=qt(m,p),d.x=s.x=Ut(m,qe,p),d.x2=s.x2=Ut(m,f),o.y=Ut(m,p),Ge({type:"rule",role:"axis-tick",key:Ae,from:n,encode:l},i)}(e,o,d.ticks,r,l,b))),n.labels&&(l=n.ticks?l:0,s.push(ri(e,o,d.labels,r,l,b))),n.domain&&s.push(function(e,t,i,n){let a,r,l,s=He(e,t),o=e.orient;a={enter:r={opacity:qe},update:l={opacity:Ue},exit:{opacity:qe}},c(a,{stroke:s("domainColor"),strokeCap:s("domainCap"),strokeDash:s("domainDash"),strokeDashOffset:s("domainDashOffset"),strokeWidth:s("domainWidth"),strokeOpacity:s("domainOpacity")});const u=ii(e,0),d=ii(e,1);return r.x=l.x=qt(o,u,qe),r.x2=l.x2=qt(o,d),r.y=l.y=Ut(o,u,qe),r.y2=l.y2=Ut(o,d),Ge({type:"rule",role:"axis-domain",from:n,encode:a},i)}(e,o,d.domain,a)),n.title&&s.push(li(e,o,d.title,a)),Dt(Me({role:"axis",from:a,encode:p,marks:s,aria:y("aria"),description:y("description"),zindex:y("zindex"),name:g,interactive:m,style:h}),i)}function oi(e,i,n){const r=t.array(e.signals),l=t.array(e.scales);return n||r.forEach(e=>R(e,i)),t.array(e.projections).forEach(e=>function(e,t){const i=t.config.projection||{},n={};for(const i in e)"name"!==i&&(n[i]=Le(e[i],i,t));for(const e in i)null==n[e]&&(n[e]=Le(i[e],e,t));t.addProjection(e.name,n)}(e,i)),l.forEach(e=>function(e,i){const n=e.type||"linear";a.isValidScaleType(n)||t.error("Unrecognized scale type: "+t.stringValue(n)),i.addScale(e.name,{type:n,domain:void 0})}(e,i)),t.array(e.data).forEach(e=>Lt(e,i)),l.forEach(e=>Oe(e,i)),(n||r).forEach(e=>X(e,i)),t.array(e.axes).forEach(e=>si(e,i)),t.array(e.marks).forEach(e=>Dt(e,i)),t.array(e.legends).forEach(e=>Vt(e,i)),e.title&&Et(e.title,i),i.parseLambdas(),i}function ui(e,i){const n=i.config,a=W(i.root=i.add(w())),r=function(e,i){const n=t=>L(e[t],i[t]),a=[di("background",n("background")),di("autosize",l(n("autosize"))),di("padding",o(n("padding"))),di("width",n("width")||0),di("height",n("height")||0)],r=a.reduce((e,t)=>(e[t.name]=t,e),{}),s={};return t.array(e.signals).forEach(e=>{t.hasOwnProperty(r,e.name)?e=t.extend(r[e.name],e):a.push(e),s[e.name]=e}),t.array(i.signals).forEach(e=>{t.hasOwnProperty(s,e.name)||t.hasOwnProperty(r,e.name)||a.push(e)}),a}(e,n);r.forEach(e=>R(e,i)),i.description=e.description||n.description,i.eventConfig=n.events,i.legends=i.objectProperty(n.legend&&n.legend.layout),i.locale=n.locale;const s=i.add(J()),u=i.add(ee(k((e=>f({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),"group","frame",e.style,i,{pulse:W(s)}))),d=i.add(ke({layout:i.objectProperty(e.layout),legends:i.legends,autosize:i.signalRef("autosize"),mark:a,pulse:W(u)}));i.operators.pop(),i.pushState(W(u),W(d),null),oi(e,i,r),i.operators.push(d);let c=i.add(Q({mark:a,pulse:W(d)}));return c=i.add(he({pulse:W(c)})),c=i.add(be({pulse:W(c)})),i.addData("root",new zt(i,s,s,c)),i}function di(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function ci(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function fi(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function pi(e){return(t.isArray(e)?gi:mi)(e)}function gi(e){let i,n="[",a=0,r=e.length;for(;a<r;++a)i=e[a],n+=(a>0?",":"")+(t.isObject(i)?i.signal||pi(i):t.stringValue(i));return n+"]"}function mi(e){let i,n,a="{",r=0;for(i in e)n=e[i],a+=(++r>1?",":"")+t.stringValue(i)+":"+(t.isObject(n)?n.signal||pi(n):t.stringValue(n));return a+"}"}function hi(){return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}ci.prototype=fi.prototype={parse(e){return oi(e,this)},fork(){return new fi(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((function(t){t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof z?W(e):e;return this.add(ge({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function i(e,t,i){let n,a;e&&(n=e.data||(e.data={}),a=n[t]||(n[t]=[]),a.push(i))}for(e in this.data){t=this.data[e],i(t.input,e,"input"),i(t.output,e,"output"),i(t.values,e,"values");for(const n in t.index)i(t.index[n],e,"index:"+n)}return this},pushState(e,t,i){this._encode.push(W(this.add(be({pulse:e})))),this._parent.push(t),this._lookup.push(i?W(this.proxy(i)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return t.peek(this._parent)},encode(){return t.peek(this._encode)},lookup(){return t.peek(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,i){if(t.isString(e))return P(e,i);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));let n=e.signal,a=this.field[n];if(!a){const e={name:this.signalRef(n)};i&&(e.as=i),this.field[n]=a=W(this.add(ne(e)))}return a},compareRef(e){let i=!1;const n=e=>E(e)?(i=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(i=!0,this.exprRef(e.expr)):e,a=t.array(e.field).map(n),r=t.array(e.order).map(n);return i?W(this.add(K({fields:a,orders:r}))):V(a,r)},keyRef(e,i){let n=!1;const a=this.signals;return e=t.array(e).map(e=>E(e)?(n=!0,W(a[e.signal])):e),n?W(this.add(ae({fields:e,flat:i}))):function(e,t){const i={$key:e};return t&&(i.$flat=!0),i}(e,i)},sortRef(e){if(!e)return e;const t=C(e.op,e.field),i=e.order||"ascending";return i.signal?W(this.add(K({fields:t,orders:this.signalRef(i.signal)}))):V(t,i)},event(e,t){const i=e+":"+t;if(!this.events[i]){const n=this.id();this.streams.push({id:n,source:e,type:t}),this.events[i]=n}return this.events[i]},hasOwnSignal(e){return t.hasOwnProperty(this.signals,e)},addSignal(e,i){this.hasOwnSignal(e)&&t.error("Duplicate signal name: "+t.stringValue(e));const n=i instanceof z?i:this.add(w(i));return this.signals[e]=n},getSignal(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},signalRef(e){return this.signals[e]?W(this.signals[e]):(t.hasOwnProperty(this.lambdas,e)||(this.lambdas[e]=this.add(w(null))),W(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],a=i.parseExpression(n,this),r=this.lambdas[n];r.params=a.$params,r.update=a.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&t.isObject(e)?this.signalRef(e.signal||pi(e)):e},exprRef(e,t){const n={expr:i.parseExpression(e,this)};return t&&(n.expr.$name=t),W(this.add(te(n)))},addBinding(e,i){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},i))},addScaleProj(e,i){t.hasOwnProperty(this.scales,e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(i)},addScale(e,t){this.addScaleProj(e,ye(t))},addProjection(e,t){this.addScaleProj(e,pe(t))},getScale(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},scaleRef(e){return W(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,i){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=i},getData(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},addDataPipeline(e,i){return t.hasOwnProperty(this.data,e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,zt.fromEntries(this,i))}},e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisRole="axis",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.DataScope=zt,e.FrameRole="frame",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendRole="legend",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.MarkRole="mark",e.Scope=ci,e.ScopeRole="scope",e.config=hi,e.parse=function(e,i,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),ui(e,new ci(i=t.mergeConfig({description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:"#4c78a8"},area:{fill:"#4c78a8"},image:null,line:{stroke:"#4c78a8",strokeWidth:2},path:{stroke:"#4c78a8"},rect:{fill:"#4c78a8"},rule:{stroke:"#000"},shape:{stroke:"#4c78a8"},symbol:{fill:"#4c78a8",size:64},text:{fill:"#000",font:"sans-serif",fontSize:11},trail:{fill:"#4c78a8",size:2},style:{"guide-label":{fill:"#000",font:"sans-serif",fontSize:10},"guide-title":{fill:"#000",font:"sans-serif",fontSize:11,fontWeight:"bold"},"group-title":{fill:"#000",font:"sans-serif",fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:"#000",font:"sans-serif",fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:"#ddd"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:"#888",grid:!1,gridWidth:1,gridColor:"#ddd",labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:"#888",tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:"#ddd",gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:"#888",titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}},i,e.config),n)).toRuntime()},e.signal=R,e.signalUpdates=X,e.stream=A,Object.defineProperty(e,"__esModule",{value:!0})}));