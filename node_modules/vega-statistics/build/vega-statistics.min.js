!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).vega={},t.d3)}(this,(function(t,e){"use strict";function*n(t,e){if(null==e)for(let e of t)null!=e&&""!==e&&(e=+e)>=e&&(yield e);else{let n=-1;for(let r of t)r=e(r,++n,t),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function r(t,r,o){const l=Float64Array.from(n(t,o));return l.sort(e.ascending),r.map(t=>e.quantileSorted(l,t))}function o(t,e){return r(t,[.25,.5,.75],e)}function l(t,n){let r=t.length,l=e.deviation(t,n),a=o(t,n),u=(a[2]-a[0])/1.34;return l=Math.min(l,u)||l||Math.abs(a[0])||1,1.06*l*Math.pow(r,-.2)}t.random=Math.random;const a=Math.sqrt(2*Math.PI),u=Math.SQRT2;let f=NaN;function i(e,n){e=e||0,n=null==n?1:n;let r,o,l=0,a=0;if(f==f)l=f,f=NaN;else{do{l=2*t.random()-1,a=2*t.random()-1,r=l*l+a*a}while(0===r||r>1);o=Math.sqrt(-2*Math.log(r)/r),l*=o,f=a*o}return e+l*n}function s(t,e,n){const r=(t-(e||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*a)}function c(t,e,n){let r,o=(t-(e=e||0))/(n=null==n?1:n),l=Math.abs(o);if(l>37)r=0;else{let t,e=Math.exp(-l*l/2);l<7.07106781186547?(t=.0352624965998911*l+.700383064443688,t=t*l+6.37396220353165,t=t*l+33.912866078383,t=t*l+112.079291497871,t=t*l+221.213596169931,t=t*l+220.206867912376,r=e*t,t=.0883883476483184*l+1.75566716318264,t=t*l+16.064177579207,t=t*l+86.7807322029461,t=t*l+296.564248779674,t=t*l+637.333633378831,t=t*l+793.826512519948,t=t*l+440.413735824752,r/=t):(t=l+.65,t=l+4/t,t=l+3/t,t=l+2/t,t=l+1/t,r=e/t/2.506628274631)}return o>0?1-r:r}function h(t,e,n){return t<0||t>1?NaN:(e||0)+(null==n?1:n)*u*function(t){let e,n=-Math.log((1-t)*(1+t));n<6.25?(n-=3.125,e=-364441206401782e-35,e=e*n-16850591381820166e-35,e=128584807152564e-32+e*n,e=11157877678025181e-33+e*n,e=e*n-1333171662854621e-31,e=20972767875968562e-33+e*n,e=6637638134358324e-30+e*n,e=e*n-4054566272975207e-29,e=e*n-8151934197605472e-29,e=26335093153082323e-28+e*n,e=e*n-12975133253453532e-27,e=e*n-5415412054294628e-26,e=1.0512122733215323e-9+e*n,e=e*n-4.112633980346984e-9,e=e*n-2.9070369957882005e-8,e=4.2347877827932404e-7+e*n,e=e*n-13654692000834679e-22,e=e*n-13882523362786469e-21,e=.00018673420803405714+e*n,e=e*n-.000740702534166267,e=e*n-.006033670871430149,e=.24015818242558962+e*n,e=1.6536545626831027+e*n):n<16?(n=Math.sqrt(n)-3.25,e=2.2137376921775787e-9,e=9.075656193888539e-8+e*n,e=e*n-2.7517406297064545e-7,e=1.8239629214389228e-8+e*n,e=15027403968909828e-22+e*n,e=e*n-4013867526981546e-21,e=29234449089955446e-22+e*n,e=12475304481671779e-21+e*n,e=e*n-47318229009055734e-21,e=6828485145957318e-20+e*n,e=24031110387097894e-21+e*n,e=e*n-.0003550375203628475,e=.0009532893797373805+e*n,e=e*n-.0016882755560235047,e=.002491442096107851+e*n,e=e*n-.003751208507569241,e=.005370914553590064+e*n,e=1.0052589676941592+e*n,e=3.0838856104922208+e*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,e=-27109920616438573e-27,e=e*n-2.555641816996525e-10,e=1.5076572693500548e-9+e*n,e=e*n-3.789465440126737e-9,e=7.61570120807834e-9+e*n,e=e*n-1.496002662714924e-8,e=2.914795345090108e-8+e*n,e=e*n-6.771199775845234e-8,e=2.2900482228026655e-7+e*n,e=e*n-9.9298272942317e-7,e=4526062597223154e-21+e*n,e=e*n-1968177810553167e-20,e=7599527703001776e-20+e*n,e=e*n-.00021503011930044477,e=e*n-.00013871931833623122,e=1.0103004648645344+e*n,e=4.849906401408584+e*n):e=1/0;return e*t}(2*t-1)}function d(t,e){let n,r;const o={mean(t){return arguments.length?(n=t||0,o):n},stdev(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>i(n,r),pdf:t=>s(t,n,r),cdf:t=>c(t,n,r),icdf:t=>h(t,n,r)};return o.mean(t).stdev(e)}function p(t,e){return t=t||0,e=null==e?1:e,Math.exp(t+i()*e)}function m(t,e,n){if(t<=0)return 0;e=e||0,n=null==n?1:n;const r=(Math.log(t)-e)/n;return Math.exp(-.5*r*r)/(n*a*t)}function M(t,e,n){return c(Math.log(t),e,n)}function g(t,e,n){return Math.exp(h(t,e,n))}function b(e,n){return null==n&&(n=null==e?1:e,e=0),e+(n-e)*t.random()}function w(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=e&&t<=n?1/(n-e):0}function x(t,e,n){return null==n&&(n=null==e?1:e,e=0),t<e?0:t>n?1:(t-e)/(n-e)}function y(t,e,n){return null==n&&(n=null==e?1:e,e=0),t>=0&&t<=1?e+t*(n-e):NaN}function N(t,e,n,r){const o=r-t*t,l=Math.abs(o)<1e-24?0:(n-t*e)/o;return[e-l*t,l]}function q(t,e,n,r){t=t.filter(t=>{let r=e(t),o=n(t);return null!=r&&(r=+r)>=r&&null!=o&&(o=+o)>=o}),r&&t.sort((t,n)=>e(t)-e(n));const o=t.length,l=new Float64Array(o),a=new Float64Array(o);let u,f,i,s=0,c=0,h=0;for(i of t)l[s]=u=+e(i),a[s]=f=+n(i),++s,c+=(u-c)/s,h+=(f-h)/s;for(s=0;s<o;++s)l[s]-=c,a[s]-=h;return[l,a,c,h]}function v(t,e,n,r){let o,l,a=-1;for(let u of t)o=e(u),l=n(u),null!=o&&(o=+o)>=o&&null!=l&&(l=+l)>=l&&r(o,l,++a)}function A(t,e,n,r,o){let l=0,a=0;return v(t,e,n,(t,e)=>{const n=e-o(t),u=e-r;l+=n*n,a+=u*u}),1-l/a}function F(t,e,n){let r=0,o=0,l=0,a=0,u=0;v(t,e,n,(t,e)=>{++u,r+=(t-r)/u,o+=(e-o)/u,l+=(t*e-l)/u,a+=(t*t-a)/u});const f=N(r,o,l,a),i=t=>f[0]+f[1]*t;return{coef:f,predict:i,rSquared:A(t,e,n,o,i)}}function L(t,e,n){const[r,o,l,a]=q(t,e,n),u=r.length;let f,i,s,c,h=0,d=0,p=0,m=0,M=0;for(f=0;f<u;)i=r[f],s=o[f++],c=i*i,h+=(c-h)/f,d+=(c*i-d)/f,p+=(c*c-p)/f,m+=(i*s-m)/f,M+=(c*s-M)/f;const g=p-h*h,b=h*g-d*d,w=(M*h-m*d)/b,x=(m*g-M*d)/b,y=-w*h,N=t=>w*(t-=l)*t+x*t+y+a;return{coef:[y-x*l+w*l*l+a,x-2*w*l,w],predict:N,rSquared:A(t,e,n,a,N)}}function S(t,e,n,r){const o=Array(t);let l,a,u,f;for(l=0;l<t;++l)o[l]=0;for(l=t-1;l>=0;--l)for(u=e[l],f=1,o[l]+=u,a=1;a<=l;++a)f*=(l+1-a)/a,o[l-a]+=u*Math.pow(n,a)*f;return o[0]+=r,o}function E(t){return(t=1-t*t*t)*t*t}function P(t,e,n){let r=t[e],o=n[0],l=n[1]+1;if(!(l>=t.length))for(;e>o&&t[l]-r<=r-t[o];)n[0]=++o,n[1]=l,++l}const U=.1*Math.PI/180;function I(t,e,n){const r=Math.atan2(n[1]-t[1],n[0]-t[0]),o=Math.atan2(e[1]-t[1],e[0]-t[0]);return Math.abs(r-o)}t.bandwidthNRD=l,t.bin=function(t){let e,n,r,o,l,a,u,f,i=t.maxbins||20,s=t.base||10,c=Math.log(s),h=t.divide||[5,2],d=t.extent[0],p=t.extent[1],m=t.span||p-d||Math.abs(d)||1;if(t.step)e=t.step;else if(t.steps){for(l=m/i,a=0,u=t.steps.length;a<u&&t.steps[a]<l;++a);e=t.steps[Math.max(0,a-1)]}else{for(n=Math.ceil(Math.log(i)/c),r=t.minstep||0,e=Math.max(r,Math.pow(s,Math.round(Math.log(m)/c)-n));Math.ceil(m/e)>i;)e*=s;for(a=0,u=h.length;a<u;++a)l=e/h[a],l>=r&&m/l<=i&&(e=l)}return l=Math.log(e),o=l>=0?0:1+~~(-l/c),f=Math.pow(s,-o-1),(t.nice||void 0===t.nice)&&(l=Math.floor(d/e+f)*e,d=d<l?l-e:l,p=Math.ceil(p/e)*e),{start:d,stop:p===d?d+e:p,step:e}},t.bootstrapCI=function(r,o,l,a){if(!r.length)return[void 0,void 0];let u,f,i,s,c=Float64Array.from(n(r,a)),h=c.length,d=o;for(i=0,s=Array(d);i<d;++i){for(u=0,f=0;f<h;++f)u+=c[~~(t.random()*h)];s[i]=u/h}return s.sort(e.ascending),[e.quantile(s,l/2),e.quantile(s,1-l/2)]},t.cumulativeLogNormal=M,t.cumulativeNormal=c,t.cumulativeUniform=x,t.densityLogNormal=m,t.densityNormal=s,t.densityUniform=w,t.dotbin=function(t,e,n,r){r=r||(t=>t);let o,l=0,a=1,u=t.length,f=new Float64Array(u),i=r(t[0]),s=i,c=i+e;for(;a<u;++a){if(o=r(t[a]),o>=c){for(s=(i+s)/2;l<a;++l)f[l]=s;c=o+e,i=o}s=o}for(s=(i+s)/2;l<a;++l)f[l]=s;return n?function(t,e){let n,r,o=t.length,l=0,a=1;for(;t[l]===t[a];)++a;for(;a<o;){for(n=a+1;t[a]===t[n];)++n;if(t[a]-t[a-1]<e){for(r=a+(l+n-a-a>>1);r<a;)t[r++]=t[a];for(;r>a;)t[r--]=t[l]}l=a,a=n}return t}(f,e+e/4):f},t.quantileLogNormal=g,t.quantileNormal=h,t.quantileUniform=y,t.quantiles=r,t.quartiles=o,t.randomInteger=function(e,n){let r,o,l;null==n&&(n=e,e=0);const a={min(t){return arguments.length?(r=t||0,l=o-r,a):r},max(t){return arguments.length?(o=t||0,l=o-r,a):o},sample:()=>r+Math.floor(l*t.random()),pdf:t=>t===Math.floor(t)&&t>=r&&t<o?1/l:0,cdf(t){const e=Math.floor(t);return e<r?0:e>=o?1:(e-r+1)/l},icdf:t=>t>=0&&t<=1?r-1+Math.floor(t*l):NaN};return a.min(e).max(n)},t.randomKDE=function(e,n){const r=d();let o=0;const a={data(t){return arguments.length?(e=t,o=t?t.length:0,a.bandwidth(n)):e},bandwidth(t){return arguments.length?(!(n=t)&&e&&(n=l(e)),a):n},sample:()=>e[~~(t.random()*o)]+n*r.sample(),pdf(t){let l=0,a=0;for(;a<o;++a)l+=r.pdf((t-e[a])/n);return l/n/o},cdf(t){let l=0,a=0;for(;a<o;++a)l+=r.cdf((t-e[a])/n);return l/o},icdf(){throw Error("KDE icdf not supported.")}};return a.data(e)},t.randomLCG=function(t){return function(){return(t=(1103515245*t+12345)%2147483647)/2147483647}},t.randomLogNormal=function(t,e){let n,r;const o={mean(t){return arguments.length?(n=t||0,o):n},stdev(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>p(n,r),pdf:t=>m(t,n,r),cdf:t=>M(t,n,r),icdf:t=>g(t,n,r)};return o.mean(t).stdev(e)},t.randomMixture=function(e,n){let r,o=0;const l={weights(t){return arguments.length?(r=function(t){let e,n=[],r=0;for(e=0;e<o;++e)r+=n[e]=null==t[e]?1:+t[e];for(e=0;e<o;++e)n[e]/=r;return n}(n=t||[]),l):n},distributions(t){return arguments.length?(t?(o=t.length,e=t):(o=0,e=[]),l.weights(n)):e},sample(){let n=t.random(),l=e[o-1],a=r[0],u=0;for(;u<o-1;a+=r[++u])if(n<a){l=e[u];break}return l.sample()},pdf(t){let n=0,l=0;for(;l<o;++l)n+=r[l]*e[l].pdf(t);return n},cdf(t){let n=0,l=0;for(;l<o;++l)n+=r[l]*e[l].cdf(t);return n},icdf(){throw Error("Mixture icdf not supported.")}};return l.distributions(e).weights(n)},t.randomNormal=d,t.randomUniform=function(t,e){let n,r;const o={min(t){return arguments.length?(n=t||0,o):n},max(t){return arguments.length?(r=null==t?1:t,o):r},sample:()=>b(n,r),pdf:t=>w(t,n,r),cdf:t=>x(t,n,r),icdf:t=>y(t,n,r)};return null==e&&(e=null==t?1:t,t=0),o.min(t).max(e)},t.regressionExp=function(t,e,n){const[r,o,l,a]=q(t,e,n);let u,f,i,s=0,c=0,h=0,d=0,p=0;v(t,e,n,(t,e)=>{u=r[p++],f=Math.log(e),i=u*e,s+=(e*f-s)/p,c+=(i-c)/p,h+=(i*f-h)/p,d+=(u*i-d)/p});const[m,M]=N(c/a,s/a,h/a,d/a),g=t=>Math.exp(m+M*(t-l));return{coef:[Math.exp(m-M*l),M],predict:g,rSquared:A(t,e,n,a,g)}},t.regressionLinear=F,t.regressionLoess=function(t,n,r,o){const[l,a,u,f]=q(t,n,r,!0),i=l.length,s=Math.max(2,~~(o*i)),c=new Float64Array(i),h=new Float64Array(i),d=new Float64Array(i).fill(1);for(let t=-1;++t<=2;){const n=[0,s-1];for(let t=0;t<i;++t){const e=l[t],r=n[0],o=n[1],u=e-l[r]>l[o]-e?r:o;let f=0,i=0,s=0,p=0,m=0,M=1/Math.abs(l[u]-e||1);for(let t=r;t<=o;++t){const n=l[t],r=a[t],o=E(Math.abs(e-n)*M)*d[t],u=n*o;f+=o,i+=u,s+=r*o,p+=r*u,m+=n*u}const[g,b]=N(i/f,s/f,p/f,m/f);c[t]=g+b*e,h[t]=Math.abs(a[t]-c[t]),P(l,t+1,n)}if(2===t)break;const r=e.median(h);if(Math.abs(r)<1e-12)break;for(let t,e,n=0;n<i;++n)t=h[n]/(6*r),d[n]=t>=1?1e-12:(e=1-t*t)*e}return function(t,e,n,r){const o=t.length,l=[];let a,u=0,f=0,i=[];for(;u<o;++u)a=t[u]+n,i[0]===a?i[1]+=(e[u]-i[1])/++f:(f=0,i[1]+=r,i=[a,e[u]],l.push(i));return i[1]+=r,l}(l,c,u,f)},t.regressionLog=function(t,e,n){let r=0,o=0,l=0,a=0,u=0;v(t,e,n,(t,e)=>{++u,t=Math.log(t),r+=(t-r)/u,o+=(e-o)/u,l+=(t*e-l)/u,a+=(t*t-a)/u});const f=N(r,o,l,a),i=t=>f[0]+f[1]*Math.log(t);return{coef:f,predict:i,rSquared:A(t,e,n,o,i)}},t.regressionPoly=function(t,e,n,r){if(1===r)return F(t,e,n);if(2===r)return L(t,e,n);const[o,l,a,u]=q(t,e,n),f=o.length,i=[],s=[],c=r+1;let h,d,p,m,M;for(h=0;h<c;++h){for(p=0,m=0;p<f;++p)m+=Math.pow(o[p],h)*l[p];for(i.push(m),M=new Float64Array(c),d=0;d<c;++d){for(p=0,m=0;p<f;++p)m+=Math.pow(o[p],h+d);M[d]=m}s.push(M)}s.push(i);const g=function(t){const e=t.length-1,n=[];let r,o,l,a,u;for(r=0;r<e;++r){for(a=r,o=r+1;o<e;++o)Math.abs(t[r][o])>Math.abs(t[r][a])&&(a=o);for(l=r;l<e+1;++l)u=t[l][r],t[l][r]=t[l][a],t[l][a]=u;for(o=r+1;o<e;++o)for(l=e;l>=r;l--)t[l][o]-=t[l][r]*t[r][o]/t[r][r]}for(o=e-1;o>=0;--o){for(u=0,l=o+1;l<e;++l)u+=t[l][o]*n[l];n[o]=(t[e][o]-u)/t[o][o]}return n}(s),b=t=>{t-=a;let e=u+g[0]+g[1]*t+g[2]*t*t;for(h=3;h<c;++h)e+=g[h]*Math.pow(t,h);return e};return{coef:S(c,g,-a,u),predict:b,rSquared:A(t,e,n,u,b)}},t.regressionPow=function(t,e,n){let r=0,o=0,l=0,a=0,u=0,f=0;v(t,e,n,(t,e)=>{const n=Math.log(t),i=Math.log(e);++f,r+=(n-r)/f,o+=(i-o)/f,l+=(n*i-l)/f,a+=(n*n-a)/f,u+=(e-u)/f});const i=N(r,o,l,a),s=t=>i[0]*Math.pow(t,i[1]);return i[0]=Math.exp(i[0]),{coef:i,predict:s,rSquared:A(t,e,n,u,s)}},t.regressionQuad=L,t.sampleCurve=function(t,e,n,r){n=n||25,r=Math.max(n,r||200);const o=e=>[e,t(e)],l=e[0],a=e[1],u=a-l,f=u/r,i=[o(l)],s=[];if(n===r){for(let t=1;t<r;++t)i.push(o(l+t/n*u));return i.push(o(a)),i}s.push(o(a));for(let t=n;--t>0;)s.push(o(l+t/n*u));let c=i[0],h=s[s.length-1];for(;h;){const t=o((c[0]+h[0])/2);t[0]-c[0]>=f&&I(c,t,h)>U?s.push(t):(c=h,i.push(h),s.pop()),h=s[s.length-1]}return i},t.sampleLogNormal=p,t.sampleNormal=i,t.sampleUniform=b,t.setRandom=function(e){t.random=e},Object.defineProperty(t,"__esModule",{value:!0})}));